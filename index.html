<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互動式網站設計報價單 - 崴浤科技</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f7fafc;
        }
        .nav-link.active {
            border-bottom-color: #3b82f6;
            color: #2563eb;
            font-weight: 700;
        }
        .tab-content {
            transition: opacity 0.5s ease-in-out;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .form-input {
            @apply px-3 py-2 border border-gray-300 rounded-md w-full;
        }
        .number-input-wrapper {
            @apply flex items-center;
        }
        .number-input {
            -moz-appearance: textfield;
            @apply w-12 h-8 text-center border-t-2 border-b-2 border-black focus:outline-none focus:ring-0 font-bold bg-yellow-100;
        }
        .number-input::-webkit-inner-spin-button,
        .number-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .stepper-btn {
            @apply bg-gray-200 w-8 h-8 flex items-center justify-center font-extrabold text-lg text-gray-700 hover:bg-gray-300 transition-colors duration-200 border-2 border-black;
        }
        .stepper-btn.minus {
            @apply rounded-l-md border-r-0;
        }
        .stepper-btn.plus {
            @apply rounded-r-md border-l-0;
        }
        .package-card.selected {
            @apply ring-4 ring-offset-2 ring-blue-500;
        }
        .compare-btn.added {
            @apply bg-yellow-500 text-white;
        }

        /* Print-specific styles */
        @media print {
            .no-print {
                display: none !important;
            }
            body {
                background-color: white !important;
            }
            .print-container {
                width: 100%;
                box-shadow: none !important;
                margin: 0;
                padding: 0;
            }
        }
        @page {
            size: A4;
            margin: 1.5cm;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Entry Password Modal -->
    <div id="entry-password-modal" class="fixed inset-0 bg-gray-900 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-4 text-center">請輸入密碼</h2>
            <form id="entry-password-form">
                <input type="password" id="entry-password-input" class="form-input w-full mb-4" placeholder="Password">
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">進入系統</button>
                <p id="entry-password-error" class="text-red-500 text-sm mt-2 text-center hidden">密碼錯誤，請重試。</p>
            </form>
        </div>
    </div>

    <!-- Control Panel Password Modal -->
    <div id="password-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-4 text-center">控制台密碼</h2>
            <form id="password-form">
                <input type="password" id="password-input" class="form-input w-full mb-4" placeholder="Password">
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">登入</button>
                <p id="password-error" class="text-red-500 text-sm mt-2 text-center hidden">密碼錯誤，請重試。</p>
            </form>
        </div>
    </div>
    
    <!-- Price Settings Modal -->
    <div id="price-settings-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-40 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold">價格調整控制台</h2>
                <button id="close-price-settings" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="price-settings-container" class="space-y-3 overflow-y-auto flex-grow">
                <!-- Price adjustment inputs will be generated here by JavaScript -->
            </div>
             <div class="mt-6 border-t pt-4">
                <h3 class="text-lg font-semibold mb-2">新增自訂義項目</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="text" id="custom-item-name" placeholder="項目名稱" class="form-input">
                    <input type="number" id="custom-item-price" placeholder="項目價格" class="form-input">
                    <button id="add-custom-item" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">新增項目</button>
                </div>
            </div>
        </div>
    </div>


    <div id="app-container" class="hidden">
        <div class="container mx-auto p-4 md:p-8">
            
            <!-- Editable Header -->
            <header class="bg-white p-6 rounded-xl shadow-md mb-8 no-print">
                 <div class="flex justify-between items-start">
                    <div class="grid md:grid-cols-2 gap-6 w-full">
                        <div>
                            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">崴浤科技股份有限公司</h1>
                            <p class="text-gray-500 text-sm">網站設計 & SEO 優化方案</p>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center gap-4">
                                <label for="project-manager-name" class="text-sm font-medium text-gray-700 w-20 flex-shrink-0 text-right">客戶經理</label>
                                <input type="text" id="project-manager-name" value="" placeholder="專案人員姓名" class="form-input text-sm">
                            </div>
                            <div class="flex items-center gap-4">
                                <label for="project-manager-phone" class="text-sm font-medium text-gray-700 w-20 flex-shrink-0 text-right">聯絡方式</label>
                                <input type="text" id="project-manager-phone" value="" placeholder="專案人員電話" class="form-input text-sm">
                            </div>
                            <div class="flex items-center gap-4">
                                <label for="project-manager-email" class="text-sm font-medium text-gray-700 w-20 flex-shrink-0 text-right">Email</label>
                                <input type="email" id="project-manager-email" value="" placeholder="專案人員Email" class="form-input text-sm">
                            </div>
                        </div>
                    </div>
                    <button id="open-price-settings" class="ml-4 text-gray-500 hover:text-blue-600 transition-colors">
                        <i class="fas fa-cog fa-2x"></i>
                    </button>
                </div>
            </header>
            
            <!-- Customer Info Form -->
            <div id="customer-info-form" class="bg-white p-6 rounded-xl shadow-md mb-8 no-print">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">客戶資料 (列印用)</h3>
                    <button id="clear-customer-info" class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 text-sm">
                        <i class="fas fa-user-times mr-1"></i>清空客戶資料
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <input type="text" id="cust-quote-num" placeholder="報價單號" class="form-input bg-gray-100" readonly>
                    <input type="date" id="cust-date" class="form-input bg-gray-100" readonly>
                    <input type="text" id="cust-name" placeholder="公司名稱" class="form-input">
                    <input type="text" id="cust-contact" placeholder="聯絡人" class="form-input">
                    <input type="text" id="cust-tel" placeholder="電話" class="form-input">
                    <input type="text" id="cust-email" placeholder="Email" class="form-input">
                    <input type="text" id="cust-tax-id" placeholder="統一編號" class="form-input">
                    <input type="text" id="cust-address" placeholder="地址" class="form-input">
                </div>
            </div>


            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Main Content -->
                <main class="w-full lg:w-2/3">
                    <nav class="bg-white rounded-t-xl shadow-md no-print">
                        <div class="flex border-b border-gray-200 overflow-x-auto no-scrollbar">
                            <a href="#" class="nav-link active text-sm md:text-base p-4 border-b-2 border-transparent hover:border-blue-500 hover:bg-gray-50 whitespace-nowrap" data-tab="combo-packages">組合方案</a>
                            <a href="#" class="nav-link text-sm md:text-base p-4 border-b-2 border-transparent hover:border-blue-500 hover:bg-gray-50 whitespace-nowrap" data-tab="website-design">網站設計</a>
                            <a href="#" class="nav-link text-sm md:text-base p-4 border-b-2 border-transparent hover:border-blue-500 hover:bg-gray-50 whitespace-nowrap" data-tab="seo-marketing">SEO 行銷</a>
                            <a href="#" class="nav-link text-sm md:text-base p-4 border-b-2 border-transparent hover:border-blue-500 hover:bg-gray-50 whitespace-nowrap" data-tab="premium-package">頂級方案</a>
                            <a href="#" class="nav-link text-sm md:text-base p-4 border-b-2 border-transparent hover:border-blue-500 hover:bg-gray-50 whitespace-nowrap" data-tab="additional-services">加購服務</a>
                        </div>
                    </nav>

                    <div class="bg-white p-6 rounded-b-xl shadow-md no-print">
                        
                        <!-- Combo Packages Tab -->
                        <div id="combo-packages" class="tab-content space-y-8">
                            <!-- Custom Packages Container -->
                            <div id="packages-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Custom packages will be injected here -->
                            </div>
                        </div>

                        <!-- Website Design Tab -->
                        <div id="website-design" class="tab-content hidden space-y-6">
                            
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="project-design">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-blue-700">專案設計</h3>
                                        <p class="text-gray-500 mt-1">打造獨一無二的高質感品牌網站，提供全方位規劃服務。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-blue-600 focus:ring-blue-500 cursor-pointer ml-4" 
                                           data-name="專案設計" data-price="398000">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>專案經理輔助：</b>搭配專案經理輔助專案執行 (視訊溝通+3次外訪)</li>
                                    <li><b>專案流程規劃：</b>專案流程及設計時程規劃／設計及修改進度跟催／資料準備清單</li>
                                    <li><b>客製設計：</b>客製首頁提版設計1款，首頁每區塊設計師提出流行素材案例</li>
                                    <li><b>動態首頁：</b>動態全景式首頁（首頁Banner＊3、內頁Banner＊1）</li>
                                    <li><b>頁面設計：</b>首頁"五大主題"區域設計 + 內頁主選項頁面設計"5頁"</li>
                                    <li><b>商用圖庫：</b>123RF / iStock 圖庫 20 張（限網頁設計使用版權商用圖庫）</li>
                                    <li><b>技術規格：</b>全站 RWD 響應式網頁，語言版本：中文＆英文</li>
                                </ul>
                                <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-blue-600 price-display" data-price-id="project-design">NT$ 398,000</span></p>
                                </div>
                                <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-1" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-blue-600 focus:ring-blue-500 cursor-pointer" 
                                                   data-renewal-price="48000" data-name="專案設計 - 續約">
                                            <label for="renewal-check-1" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="project-design">NT$ 48,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="basic-design">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-green-700">基礎形象客製設計</h3>
                                        <p class="text-gray-500 mt-1">適合需要建立專業形象，並具備高度彈性的企業。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-green-600 focus:ring-green-500 cursor-pointer ml-4" 
                                           data-name="基礎形象客製設計" data-price="200000">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>客製提版：</b>企業網站客製平面提版，首頁"三大主題"區塊設計</li>
                                    <li><b>頁面設計：</b>內頁頁面設計"2頁"</li>
                                    <li><b>靜態首頁：</b>靜態全景式首頁（首頁Banner＊2、內頁Banner＊1）</li>
                                    <li><b>商用圖庫：</b>123RF / iStock 版權圖庫 10 張（限網頁設計用版權商用圖庫）</li>
                                    <li><b>技術規格：</b>全站 RWD 響應式網頁，語言版本：中文＆英文</li>
                                </ul>
                                <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-green-600 price-display" data-price-id="basic-design">NT$ 200,000</span></p>
                                </div>
                                 <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-2" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-green-600 focus:ring-green-500 cursor-pointer" 
                                                   data-renewal-price="20000" data-name="基礎形象客製設計 - 續約">
                                            <label for="renewal-check-2" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="basic-design">NT$ 20,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="winshop-template">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-purple-700">Winshop 新公版</h3>
                                        <p class="text-gray-500 mt-1">更具彈性的模組化公版，自由組合出 125 種獨特樣式。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-purple-600 focus:ring-purple-500 cursor-pointer ml-4" 
                                           data-name="Winshop新公版" data-price="128000">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>Banner設計：</b>首頁Banner＊2、內頁Banner＊1</li>
                                    <li><b>背景設計：</b>首頁區塊背景設計（公司簡介圖片＆背景圖、產品背景圖、最新消息背景圖）</li>
                                    <li><b>模組化版型：</b>首頁版型-開發版型模組選擇：公司簡介、產品介紹、最新消息</li>
                                    <li><b>內頁版型：</b>內頁版型-開發版型模組選擇：產品介紹、聯絡我們</li>
                                    <li><b>彈性組合：</b>每個模組提供5種選擇，可組合為125種樣式</li>
                                    <li><b>商用圖庫：</b>123RF / iStock圖庫10張（限網頁設計使用版權商用圖庫）</li>
                                </ul>
                                <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-purple-600 price-display" data-price-id="winshop-template">NT$ 128,000</span></p>
                                </div>
                                <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-3" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-purple-600 focus:ring-purple-500 cursor-pointer" 
                                                   data-renewal-price="20000" data-name="Winshop 新公版 - 續約">
                                            <label for="renewal-check-3" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="winshop-template">NT$ 20,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                         <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- SEO Marketing Tab -->
                        <div id="seo-marketing" class="tab-content hidden space-y-6">
                            
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="seo-cross-border">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-red-700">跨國 SEO 行銷優化服務</h3>
                                        <p class="text-gray-500 mt-1">拓展全球業務，讓世界看見您的品牌。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-red-600 focus:ring-red-500 cursor-pointer ml-4" 
                                           data-name="跨國SEO行銷優化服務" data-price="300000">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>優化目標：</b>Google.com 搜尋引擎優化（英文）+ Google.com.tw 搜尋引擎優化（中文）</li>
                                    <li><b>關鍵字：</b>可同時優化中文+英文關鍵字，合計優化 20 組關鍵字</li>
                                    <li><b>關鍵字規劃：</b>關鍵字分析、評估、挑選，20組連結頁面重點優化</li>
                                    <li><b>技術優化：</b>結構化／多國語系／網址／sitemap／Robots等</li>
                                    <li><b>內容優化：</b>META／ALT／H標籤／文案／內容優化調整建議／社群等</li>
                                    <li><b>全球主機：</b>五大洲多節點智能主機（外銷升級），提升國際使用者體驗</li>
                                    <li><b>成效追蹤：</b>每月提供關鍵字排名報表，串接 GA4、GSC 數據分析工具</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-red-600 price-display" data-price-id="seo-cross-border">NT$ 300,000</span></p>
                                </div>
                                <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-4" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-red-600 focus:ring-red-500 cursor-pointer" 
                                                   data-renewal-price="250000" data-name="跨國 SEO - 續約">
                                            <label for="renewal-check-4" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="seo-cross-border">NT$ 250,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="seo-chinese">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-teal-700">中文 SEO 行銷優化服務</h3>
                                        <p class="text-gray-500 mt-1">深耕在地市場，精準觸及台灣客戶。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-teal-600 focus:ring-teal-500 cursor-pointer ml-4" 
                                           data-name="中文SEO行銷優化服務" data-price="250000">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>優化目標：</b>Google.com.tw 搜尋引擎優化</li>
                                    <li><b>關鍵字：</b>可優化中文關鍵字合計共 20 組</li>
                                    <li><b>關鍵字規劃：</b>關鍵字分析、評估、挑選，20組連結頁面重點優化</li>
                                    <li><b>技術優化：</b>結構化／多國語系／網址／sitemap／Robots等</li>
                                    <li><b>內容優化：</b>META／ALT／H標籤／文案／內容優化調整建議／社群等</li>
                                    <li><b>在地化提交：</b>提交至 Google（桌機、手機版）、BING 搜尋引擎</li>
                                    <li><b>成效追蹤：</b>每月提供關鍵字排名報表，串接 GA4、GSC 數據分析工具</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-teal-600 price-display" data-price-id="seo-chinese">NT$ 250,000</span></p>
                                </div>
                                 <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-5" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-teal-600 focus:ring-teal-500 cursor-pointer" 
                                                   data-renewal-price="200000" data-name="中文 SEO - 續約">
                                            <label for="renewal-check-5" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="seo-chinese">NT$ 200,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Premium Package Tab -->
                        <div id="premium-package" class="tab-content hidden space-y-6">
                            
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="premium-chinese">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-orange-700">專案行銷頂級方案 (中文SEO)</h3>
                                        <p class="text-gray-500 mt-1">專案設計+中文SEO頂級整合方案，加量不加價。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-orange-600 focus:ring-orange-500 cursor-pointer ml-4" 
                                           data-name="專案行銷頂級方案(中文SEO)" data-price="700000">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>Winshop系統：</b>Winshop 系統核心，語系開版1款</li>
                                    <li><b>視覺設計：</b>首頁視覺風格設計2款（電腦版、手機版），3張首頁橫幅廣告banner設計</li>
                                    <li><b>頁面設計：</b>內頁設計7頁（每頁最多5區塊，含banner橫幅）</li>
                                    <li><b>ESG功能：</b>ESG 訊息管理功能，設計切版1頁主頁、1頁內容</li>
                                    <li><b>內容撰寫：</b>部落格文案3篇</li>
                                    <li><b>手機版設計：</b>手機版選單設計一式</li>
                                    <li><b>動態特效：</b>首頁、內頁基礎動態特效</li>
                                    <li><b>專案服務：</b>專案、設計師一起執行視覺設計規劃，全方位專案追蹤服務</li>
                                    <li><b>SEO升級：</b>中文關鍵字30組（比一般方案多10組）</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-orange-600 price-display" data-price-id="premium-chinese">NT$ 700,000</span></p>
                                </div>
                                <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-6" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-orange-600 focus:ring-orange-500 cursor-pointer" 
                                                   data-renewal-price="248000" data-name="專案行銷頂級方案(中文SEO) - 續約">
                                            <label for="renewal-check-6" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="premium-chinese">NT$ 248,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="premium-english">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-indigo-700">專案行銷頂級方案 (英文SEO)</h3>
                                        <p class="text-gray-500 mt-1">專案設計+英文SEO頂級整合方案，拓展國際市場。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-indigo-600 focus:ring-indigo-500 cursor-pointer ml-4" 
                                           data-name="專案行銷頂級方案(英文SEO)" data-price="750000">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>Winshop系統：</b>Winshop 系統核心，語系開版1款</li>
                                    <li><b>視覺設計：</b>首頁視覺風格設計2款（電腦版、手機版），3張首頁橫幅廣告banner設計</li>
                                    <li><b>頁面設計：</b>內頁設計7頁（每頁最多5區塊，含banner橫幅）</li>
                                    <li><b>ESG功能：</b>ESG 訊息管理功能，設計切版1頁主頁、1頁內容</li>
                                    <li><b>內容撰寫：</b>部落格文案3篇</li>
                                    <li><b>手機版設計：</b>手機版選單設計一式</li>
                                    <li><b>動態特效：</b>首頁、內頁基礎動態特效</li>
                                    <li><b>專案服務：</b>專案、設計師一起執行視覺設計規劃，全方位專案追蹤服務</li>
                                    <li><b>SEO升級：</b>英文關鍵字30組（比一般方案多10組）</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-indigo-600 price-display" data-price-id="premium-english">NT$ 750,000</span></p>
                                </div>
                                 <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-7" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-indigo-600 focus:ring-indigo-500 cursor-pointer" 
                                                   data-renewal-price="268000" data-name="專案行銷頂級方案(英文SEO) - 續約">
                                            <label for="renewal-check-7" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="premium-english">NT$ 268,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Services Tab -->
                        <div id="additional-services" class="tab-content hidden space-y-6">
                            
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="https">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-gray-700">HTTPS 安全加密</h3>
                                        <p class="text-gray-500 mt-1">提供網站安全加密服務，提升網站安全等級。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-gray-600 focus:ring-gray-500 cursor-pointer ml-4" 
                                           data-name="HTTPS安全加密" data-price="6200" data-renewal="0">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>SSL憑證：</b>HTTPS 加密主機（SSL 憑證）</li>
                                    <li><b>最新技術：</b>最新升級 HTTP/3</li>
                                    <li><b>安全等級：</b>提升 HSTS 加密技術，系統安全 A+</li>
                                    <li><b>多語系：</b>其本語系：中、英、簡</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800">費用: <span class="font-bold text-2xl text-gray-600 price-display" data-price-id="">NT$ 6,200</span> <span class="text-sm text-green-600">(3年約贈送)</span></p>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="investor-relations">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-cyan-700">投資人專區</h3>
                                        <p class="text-gray-500 mt-1">符合上市櫃公司投資人專區需求的專業模組。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-cyan-600 focus:ring-cyan-500 cursor-pointer ml-4" 
                                           data-name="投資人專區" data-price="40000" data-renewal="0">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>專業功能：</b>符合 80%上市櫃公司投資人專區需求</li>
                                    <li><b>搜尋設定：</b>搜尋設定、自訂表格設定等模組功能</li>
                                    <li><b>參考案例：</b>惠特科技 6706</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800">費用: <span class="font-bold text-2xl text-cyan-600 price-display" data-price-id="investor-relations">NT$ 40,000</span></p>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="inner-page-design">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-pink-700">內頁設計</h3>
                                        <p class="text-gray-500 mt-1">單一頁面風格提版設計服務。</p>
                                        <div class="mt-2">
                                            <label class="text-sm text-gray-600">頁數：</label>
                                            <div class="number-input-wrapper inline-flex">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" min="1" max="20" value="1" class="inner-page-count number-input" data-base-price="20000">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-pink-600 focus:ring-pink-500 cursor-pointer ml-4" 
                                           data-name="內頁設計" data-price="20000" data-renewal="0">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>風格提版：</b>單一頁面（內頁）風格提版（不含Banner設計）</li>
                                    <li><b>文案效果：</b>僅編輯器內的文案效果，不抓取其他程式及動態效果</li>
                                    <li><b>語系費用：</b>僅收單一語系費用，其他語系套用無需額外費用</li>
                                    <li><b>響應式：</b>Layout 切版/RWD 響應式網頁效果</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800">費用: <span class="font-bold text-2xl text-pink-600 inner-page-total price-display" data-price-id="inner-page-design">NT$ 20,000</span> /頁</p>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="language-add">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-emerald-700">新增語系</h3>
                                        <p class="text-gray-500 mt-1">為網站新增其他語言版本。</p>
                                        <div class="mt-2 space-y-2">
                                            <div class="flex items-center gap-2">
                                                <label class="text-sm text-gray-600 w-24">一般語系數量：</label>
                                                <div class="number-input-wrapper">
                                                    <button type="button" class="stepper-btn minus">-</button>
                                                    <input type="number" min="0" max="10" value="0" class="language-count number-input" data-price="8000">
                                                    <button type="button" class="stepper-btn plus">+</button>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <label class="text-sm text-gray-600 w-24">特殊語系數量：</label>
                                                <div class="number-input-wrapper">
                                                    <button type="button" class="stepper-btn minus">-</button>
                                                    <input type="number" min="0" max="10" value="0" class="special-language-count number-input" data-price="10000">
                                                    <button type="button" class="stepper-btn plus">+</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-emerald-600 focus:ring-emerald-500 cursor-pointer ml-4" 
                                           data-name="新增語系" data-price="0" data-renewal="0">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>一般語系：</b>網站建置每新增一語系 NT$ 8,000</li>
                                    <li><b>特殊語系：</b>如阿拉伯文（右至左排版）每語系 NT$ 10,000</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800 language-cost-p hidden">費用: <span class="font-bold text-2xl text-emerald-600 language-total">NT$ 0</span></p>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="blog-writing">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-violet-700">部落格文案撰寫</h3>
                                        <p class="text-gray-500 mt-1">專業文案撰寫服務，提升網站內容品質。</p>
                                        <div class="mt-2 space-y-2">
                                            <div class="flex items-center gap-2">
                                                <label class="text-sm text-gray-600 w-24">中文文案篇數：</label>
                                                <div class="number-input-wrapper">
                                                    <button type="button" class="stepper-btn minus">-</button>
                                                    <input type="number" min="0" max="50" value="0" class="chinese-blog-count number-input" data-price="15000">
                                                    <button type="button" class="stepper-btn plus">+</button>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <label class="text-sm text-gray-600 w-24">英文文案篇數：</label>
                                                <div class="number-input-wrapper">
                                                    <button type="button" class="stepper-btn minus">-</button>
                                                    <input type="number" min="0" max="50" value="0" class="english-blog-count number-input" data-price="15000">
                                                    <button type="button" class="stepper-btn plus">+</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-violet-600 focus:ring-violet-500 cursor-pointer ml-4" 
                                           data-name="部落格文案撰寫" data-price="0" data-renewal="0">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>中文文案：</b>中文 1200 字文案撰寫 NT$ 15,000/篇</li>
                                    <li><b>英文文案：</b>英文 1200 字文案撰寫 NT$ 15,000/篇</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800 blog-cost-p hidden">費用: <span class="font-bold text-2xl text-violet-600 blog-total">NT$ 0</span></p>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="mailcloud">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-blue-700">MailCloud郵件代管(5G)</h3>
                                        <p class="text-gray-500 mt-1">費用計算方式為 首次設定費1000，一組mail 1200/年。</p>
                                        <div class="mt-4 space-y-4">
                                            <div class="flex items-center gap-4">
                                                <input type="checkbox" id="mailcloud-setup-check" class="h-5 w-5 rounded border-gray-400 text-blue-600 focus:ring-blue-500 cursor-pointer mailcloud-setup-check">
                                                <label for="mailcloud-setup-check" class="text-gray-700 cursor-pointer">首次設定費</label>
                                            </div>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label class="text-sm text-gray-600">郵件帳號數量</label>
                                                    <div class="number-input-wrapper">
                                                        <button type="button" class="stepper-btn minus">-</button>
                                                        <input type="number" min="0" value="0" class="mailcloud-quantity number-input">
                                                        <button type="button" class="stepper-btn plus">+</button>
                                                    </div>
                                                </div>
                                                <div>
                                                    <label class="text-sm text-gray-600">使用年份</label>
                                                    <div class="number-input-wrapper">
                                                        <button type="button" class="stepper-btn minus">-</button>
                                                        <input type="number" min="0" value="0" class="mailcloud-years number-input">
                                                        <button type="button" class="stepper-btn plus">+</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-blue-600 focus:ring-blue-500 cursor-pointer ml-4" 
                                           data-name="MailCloud郵件代管(5G)" data-price="0" data-renewal="0">
                                </div>
                                <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">總計費用</p>
                                   <p class="text-gray-800 mailcloud-cost-p hidden">費用: <span class="font-bold text-2xl text-blue-600 mailcloud-total">NT$ 0</span></p>
                                </div>
                            </div>
                            
                             <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="custom-dev">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-purple-700">客製程式</h3>
                                        <p class="text-gray-500 mt-1">依據需求客製化程式功能。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-purple-600 focus:ring-purple-500 cursor-pointer ml-4" 
                                           data-name="客製程式" data-price="0" data-renewal="0">
                                </div>
                                <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>需求訪談：</b>與專案經理、工程師進行需求訪談。</li>
                                    <li><b>時程規劃：</b>根據功能複雜度規劃開發時程。</li>
                                    <li><b>功能交付：</b>分階段交付與測試客製化功能。</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800">費用: <span class="font-bold text-2xl text-purple-600 price-display" data-price-id="custom-dev">依工程師估價</span></p>
                                </div>
                            </div>
                        </div>

                        <!-- Price Settings Tab -->
                        <div id="price-settings" class="tab-content hidden space-y-4">
                            <h3 class="text-xl font-bold text-gray-800">調整項目價格</h3>
                            <div id="price-settings-container-main" class="space-y-3">
                                <!-- Price adjustment inputs will be generated here by JavaScript -->
                            </div>
                        </div>
                    </div>
                </main>

                <!-- Sidebar / Quote Summary -->
                <aside class="w-full lg:w-1/3 no-print">
                     <div class="bg-white rounded-xl shadow-md sticky top-8">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-xl font-bold flex items-center gap-3">
                                <i class="fas fa-file-invoice-dollar text-blue-500"></i>報價單預覽
                            </h3>
                            <div class="mt-4 grid grid-cols-2 gap-2">
                                <button id="clear-quote" class="w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors duration-200">
                                    <i class="fas fa-trash-alt mr-2"></i>清空報價
                                </button>
                                <button id="print-quote" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                                    <i class="fas fa-print mr-2"></i>列印報價單
                                </button>
                            </div>
                             <div class="mt-4 flex items-center justify-end">
                                <input type="checkbox" id="include-tax-checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <label for="include-tax-checkbox" class="ml-2 text-sm font-medium text-gray-700">顯示含稅價格 (5%)</label>
                            </div>
                        </div>
                        <div id="quote-summary" class="p-6 space-y-3 min-h-[150px]">
                           <p id="empty-quote" class="text-center text-gray-500 pt-12">尚未選擇任何服務項目。</p>
                        </div>
                        <div class="p-6 bg-gray-50 rounded-b-xl">
                            <!-- Save Package Section -->
                            <div id="save-package-section" class="mb-4">
                                <h4 class="font-bold text-md text-gray-700 mb-2">儲存目前選項為組合</h4>
                                <div class="flex gap-2">
                                    <input type="text" id="new-package-name" placeholder="請輸入新組合方案名稱" class="form-input text-sm">
                                    <button id="save-as-package" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors duration-200 flex-shrink-0">
                                        <i class="fas fa-save"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Comparison Section -->
                            <div id="comparison-section" class="mb-4 hidden">
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="font-bold text-md text-gray-700">方案總價</h4>
                                    <button id="clear-comparison" class="text-xs text-red-500 hover:text-red-700">清除比較</button>
                                </div>
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-gray-200">
                                        <tr>
                                            <th class="p-2">方案名稱</th>
                                            <th class="p-2">平均年費</th>
                                            <th class="p-2 text-green-600">可節省預算</th>
                                            <th class="p-2"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="comparison-tbody">
                                        <!-- Comparison rows will be generated by JS -->
                                    </tbody>
                                </table>
                            </div>

                            <div class="space-y-2 mb-4">
                                 <div class="flex justify-between items-center text-gray-600">
                                    <span>平均每月金額</span>
                                    <span id="monthly-average" class="font-semibold text-lg">NT$ 0</span>
                                </div>
                            </div>
                            <div class="border-t border-gray-200 pt-4 space-y-2">
                                 <div class="flex justify-between items-center">
                                    <span class="text-lg font-bold">方案總價 (未稅)</span>
                                    <span id="grand-total" class="font-bold text-2xl text-blue-600">NT$ 0</span>
                                </div>
                                <div id="tax-total-container" class="hidden flex justify-between items-center">
                                    <span class="text-lg font-bold">方案總價 (含稅)</span>
                                    <span id="grand-total-taxed" class="font-bold text-2xl text-red-600">NT$ 0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Password Protection ---
            const ENTRY_PASSWORD = '33550336';
            const ADMIN_PASSWORD = 'winhokh';
            
            const appContainer = document.getElementById('app-container');
            
            // Entry password
            const entryPasswordModal = document.getElementById('entry-password-modal');
            const entryPasswordForm = document.getElementById('entry-password-form');
            const entryPasswordInput = document.getElementById('entry-password-input');
            const entryPasswordError = document.getElementById('entry-password-error');
            
            // Admin password
            const adminPasswordModal = document.getElementById('password-modal');
            const adminPasswordForm = document.getElementById('password-form');
            const adminPasswordInput = document.getElementById('password-input');
            const adminPasswordError = document.getElementById('password-error');
            const priceSettingsModal = document.getElementById('price-settings-modal');

            // Show entry modal on load
            entryPasswordModal.classList.remove('hidden');

            entryPasswordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (entryPasswordInput.value === ENTRY_PASSWORD) {
                    entryPasswordModal.classList.add('hidden');
                    appContainer.classList.remove('hidden');
                } else {
                    entryPasswordError.classList.remove('hidden');
                }
            });

            document.getElementById('open-price-settings').addEventListener('click', () => {
                adminPasswordModal.classList.remove('hidden');
            });
            
            document.getElementById('close-price-settings').addEventListener('click', () => {
                priceSettingsModal.classList.add('hidden');
            });

            adminPasswordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (adminPasswordInput.value === ADMIN_PASSWORD) {
                    adminPasswordModal.classList.add('hidden');
                    priceSettingsModal.classList.remove('hidden');
                    adminPasswordInput.value = '';
                    adminPasswordError.classList.add('hidden');
                } else {
                    adminPasswordError.classList.remove('hidden');
                }
            });

            // --- Global Price Store & Package Definitions ---
            let priceStore = {};
            let currentPackage = null;
            let allPackages = {};
            let comparisonList = [];

            // --- Tab Navigation ---
            const navLinks = document.querySelectorAll('.nav-link');
            const tabContents = document.querySelectorAll('.tab-content');

            navLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    navLinks.forEach(item => item.classList.remove('active'));
                    this.classList.add('active');
                    const targetTab = this.getAttribute('data-tab');
                    tabContents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== targetTab);
                    });
                });
            });
            
            document.querySelector('.nav-link[data-tab="combo-packages"]')?.click();

            // --- Quote Calculation ---
            const quoteSummary = document.getElementById('quote-summary');
            const grandTotalEl = document.getElementById('grand-total');
            const monthlyAverageEl = document.getElementById('monthly-average');
            const taxCheckbox = document.getElementById('include-tax-checkbox');
            const taxTotalContainer = document.getElementById('tax-total-container');
            const grandTotalTaxedEl = document.getElementById('grand-total-taxed');
            const comparisonSection = document.getElementById('comparison-section');
            const comparisonTbody = document.getElementById('comparison-tbody');

            function clearQuoteSelections() {
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
                document.querySelectorAll('.renewal-years, .mailcloud-years').forEach(input => input.value = '1');
                document.querySelectorAll('.renewal-discount, .first-year-discount').forEach(input => input.value = '1');
                document.querySelectorAll('.inner-page-count').forEach(input => input.value = '1');
                document.querySelectorAll('.language-count, .special-language-count, .chinese-blog-count, .english-blog-count, .mailcloud-quantity').forEach(input => input.value = '0');
                
                document.querySelectorAll('.package-card').forEach(card => card.classList.remove('selected'));
                currentPackage = null;

                updateQuote();
            }

            function updateQuote() {
                let summaryHTML = '';
                let totalCost = 0;
                let maxYears = 1;
                let hasSelections = document.querySelectorAll('.service-checkbox:checked').length > 0;

                document.querySelectorAll('div[data-service-id]').forEach(container => {
                    const serviceId = container.dataset.serviceId;
                    const mainCheckbox = container.querySelector('.service-checkbox');
                    
                    if (!mainCheckbox || !mainCheckbox.checked) return;

                    const name = mainCheckbox.dataset.name;
                    let basePrice = priceStore[serviceId]?.price || parseFloat(mainCheckbox.dataset.price) || 0;

                    // Handle addons with calculated prices
                    if (serviceId === 'inner-page-design') {
                        const count = parseInt(container.querySelector('.inner-page-count').value) || 0;
                        basePrice = (priceStore['inner-page-design']?.price || 20000) * count;
                    } else if (serviceId === 'language-add') {
                        const normalCount = parseInt(container.querySelector('.language-count').value) || 0;
                        const specialCount = parseInt(container.querySelector('.special-language-count').value) || 0;
                        basePrice = ((priceStore['language-add']?.price || 8000) * normalCount) + ((priceStore['language-add-special']?.price || 10000) * specialCount);
                    } else if (serviceId === 'blog-writing') {
                        const chineseCount = parseInt(container.querySelector('.chinese-blog-count').value) || 0;
                        const englishCount = parseInt(container.querySelector('.english-blog-count').value) || 0;
                        basePrice = ((priceStore['blog-writing']?.price || 15000) * chineseCount) + ((priceStore['blog-writing-en']?.price || 15000) * englishCount);
                    } else if (serviceId === 'mailcloud') {
                        let mailPrice = 0;
                        if (container.querySelector('.mailcloud-setup-check').checked) {
                            mailPrice += priceStore['mailcloud-setup']?.price || 1000;
                        }
                        const quantity = parseInt(container.querySelector('.mailcloud-quantity').value) || 0;
                        const years = parseInt(container.querySelector('.mailcloud-years').value) || 0;
                        mailPrice += quantity * years * (priceStore['mailcloud-account']?.price || 1200);
                        basePrice = mailPrice;
                    }
                    
                    const firstYearDiscountInput = container.querySelector('.first-year-discount');
                    const firstYearDiscount = firstYearDiscountInput ? parseFloat(firstYearDiscountInput.value) || 1 : 1;
                    const discountedFirstYearPrice = basePrice * firstYearDiscount;
                    
                    totalCost += discountedFirstYearPrice;

                    summaryHTML += `
                        <div class="flex justify-between items-center py-2 border-b border-gray-100">
                            <span class="text-sm text-gray-700">${name}</span>
                            <div class="text-right">
                                <div class="text-sm font-semibold text-gray-800">NT$ ${Math.round(discountedFirstYearPrice).toLocaleString()}</div>
                                ${firstYearDiscount !== 1 && basePrice > 0 ? `<div class="text-xs text-green-600">首年 ${Math.round(firstYearDiscount*100)} 折</div>` : ''}
                            </div>
                        </div>`;

                    const renewalCheckbox = container.querySelector('.renewal-checkbox');
                    if (renewalCheckbox && renewalCheckbox.checked) {
                        const renewalPrice = priceStore[serviceId]?.renewal || 0;
                        const yearsInput = container.querySelector('.renewal-years');
                        const discountInput = container.querySelector('.renewal-discount');
                        
                        const years = yearsInput ? parseInt(yearsInput.value) || 1 : 1;
                        const discount = discountInput ? parseFloat(discountInput.value) || 1 : 1;
                        
                        const renewalTotal = renewalPrice * years * discount;
                        totalCost += renewalTotal;
                        maxYears = Math.max(maxYears, 1 + years);

                        summaryHTML += `
                            <div class="flex justify-between items-center py-2 border-b border-gray-100 pl-4">
                                <span class="text-sm text-gray-700">${renewalCheckbox.dataset.name} (${years}年)</span>
                                <div class="text-right">
                                    <div class="text-sm font-semibold text-gray-800">NT$ ${Math.round(renewalTotal).toLocaleString()}</div>
                                    ${discount !== 1 ? `<div class="text-xs text-green-600">${Math.round(discount*100)} 折</div>` : ''}
                                </div>
                            </div>`;
                    }
                });

                const monthlyAverage = totalCost > 0 ? Math.round(totalCost / (maxYears * 12)) : 0;
                
                grandTotalEl.textContent = `NT$ ${Math.round(totalCost).toLocaleString()}`;
                monthlyAverageEl.textContent = `NT$ ${monthlyAverage.toLocaleString()}`;

                if (taxCheckbox.checked) {
                    const taxedTotal = totalCost * 1.05;
                    grandTotalTaxedEl.textContent = `NT$ ${Math.round(taxedTotal).toLocaleString()}`;
                    taxTotalContainer.classList.remove('hidden');
                } else {
                    taxTotalContainer.classList.add('hidden');
                }

                if (!hasSelections) {
                    quoteSummary.innerHTML = '<p id="empty-quote" class="text-center text-gray-500 pt-12">尚未選擇任何服務項目。</p>';
                } else {
                    quoteSummary.innerHTML = summaryHTML;
                }
            }
            
            function populatePriceSettings() {
                const container = document.getElementById('price-settings-container');
                container.innerHTML = ''; 
                const savedPrices = JSON.parse(localStorage.getItem('customPriceStore') || '{}');

                const allServices = document.querySelectorAll('.border[data-service-id]');
                
                allServices.forEach(serviceEl => {
                    const serviceId = serviceEl.dataset.serviceId;
                    if (!serviceId && serviceId !== "") return;

                    const name = serviceEl.querySelector('h3').textContent;
                    
                    const mainCheckbox = serviceEl.querySelector('.service-checkbox');
                    if (mainCheckbox && mainCheckbox.dataset.price !== "0") {
                        const defaultPrice = parseInt(mainCheckbox.dataset.price);
                        const savedPrice = savedPrices[serviceId]?.price;
                        const price = (savedPrice !== undefined) ? savedPrice : defaultPrice;
                        
                        if (!priceStore[serviceId]) priceStore[serviceId] = {};
                        priceStore[serviceId].price = price;
                        
                        const settingRow = document.createElement('div');
                        settingRow.className = 'flex justify-between items-center py-2 border-b';
                        settingRow.innerHTML = `
                            <label for="price-edit-${serviceId}" class="text-sm">${name}</label>
                            <input type="number" id="price-edit-${serviceId}" data-target-id="${serviceId}" data-price-type="price" class="form-input w-32 highlight-input" value="${price}">
                        `;
                        container.appendChild(settingRow);
                    }
                    
                    const renewalCheckbox = serviceEl.querySelector('.renewal-checkbox');
                    if (renewalCheckbox) {
                        const defaultRenewalPrice = parseInt(renewalCheckbox.dataset.renewalPrice);
                        const savedRenewalPrice = savedPrices[serviceId]?.renewal;
                        const renewalPrice = (savedRenewalPrice !== undefined) ? savedRenewalPrice : defaultRenewalPrice;

                        if (!priceStore[serviceId]) priceStore[serviceId] = {};
                        priceStore[serviceId].renewal = renewalPrice;

                        const settingRow = document.createElement('div');
                        settingRow.className = 'flex justify-between items-center py-2 border-b';
                        settingRow.innerHTML = `
                            <label for="price-edit-renewal-${serviceId}" class="text-sm">${name} - 續約</label>
                            <input type="number" id="price-edit-renewal-${serviceId}" data-target-id="${serviceId}" data-price-type="renewal" class="form-input w-32 highlight-input" value="${renewalPrice}">
                        `;
                        container.appendChild(settingRow);
                    }
                });

                // Manually add calculated items
                const calculatedItems = [
                    {id: 'language-add', name: '新增語系 (一般)', defaultPrice: 8000},
                    {id: 'language-add-special', name: '新增語系 (特殊)', defaultPrice: 10000},
                    {id: 'blog-writing', name: '部落格文案撰寫 (中文)', defaultPrice: 15000},
                    {id: 'blog-writing-en', name: '部落格文案撰寫 (英文)', defaultPrice: 15000},
                    {id: 'mailcloud-setup', name: 'MailCloud 首次設定費', defaultPrice: 1000},
                    {id: 'mailcloud-account', name: 'MailCloud 帳號費用/年', defaultPrice: 1200},
                ];

                calculatedItems.forEach(item => {
                    const savedPrice = savedPrices[item.id]?.price;
                    const price = (savedPrice !== undefined) ? savedPrice : item.defaultPrice;
                    if (!priceStore[item.id]) priceStore[item.id] = {};
                    priceStore[item.id].price = price;

                     const settingRow = document.createElement('div');
                    settingRow.className = 'flex justify-between items-center py-2 border-b';
                    settingRow.innerHTML = `
                        <label for="price-edit-${item.id}" class="text-sm">${item.name}</label>
                        <input type="number" id="price-edit-${item.id}" data-target-id="${item.id}" data-price-type="price" class="form-input w-32 highlight-input" value="${price}">
                    `;
                    container.appendChild(settingRow);
                });
                
                addPriceSettingListeners(container);
            }

            function addPriceSettingListeners(container) {
                 container.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', (e) => {
                        const targetId = e.target.dataset.targetId;
                        const priceType = e.target.dataset.priceType;
                        const newValue = parseInt(e.target.value) || 0;
                        
                        if (!priceStore[targetId]) priceStore[targetId] = {};
                        priceStore[targetId][priceType] = newValue;
                        
                        const priceDisplay = document.querySelector(`.price-display[data-price-id="${targetId}"]`);
                        if (priceDisplay && priceType === 'price') {
                             if (targetId === 'custom-dev' && newValue === 0) {
                                priceDisplay.textContent = '依工程師估價';
                            } else {
                                priceDisplay.textContent = `NT$ ${newValue.toLocaleString()}`;
                            }
                        }
                        const renewalPriceDisplay = document.querySelector(`.renewal-price-display[data-renewal-price-id="${targetId}"]`);
                        if (renewalPriceDisplay && priceType === 'renewal') {
                            renewalPriceDisplay.textContent = `NT$ ${newValue.toLocaleString()} /年`;
                        }
                        
                        localStorage.setItem('customPriceStore', JSON.stringify(priceStore));
                        updateQuote();
                    });
                });
            }

            function setupAllListeners() {
                const allInputs = document.querySelectorAll('.service-checkbox, .renewal-checkbox, .renewal-years, .renewal-discount, .first-year-discount, .inner-page-count, .language-count, .special-language-count, .chinese-blog-count, .english-blog-count, .mailcloud-setup-check, .mailcloud-quantity, .mailcloud-years, #include-tax-checkbox');
                allInputs.forEach(input => {
                    input.addEventListener('change', () => {
                        currentPackage = null;
                        document.querySelectorAll('.package-card').forEach(card => card.classList.remove('selected'));
                        updateQuote();
                    });
                });
                
                document.body.addEventListener('click', function(e) {
                    if (e.target.classList.contains('stepper-btn')) {
                        const wrapper = e.target.closest('.number-input-wrapper');
                        const input = wrapper.querySelector('.number-input');
                        const step = parseFloat(e.target.dataset.step) || 1;
                        const min = parseFloat(input.min) || 0;
                        
                        let currentValue = parseFloat(input.value);
                        if (isNaN(currentValue)) currentValue = 0;

                        if (e.target.classList.contains('plus')) {
                            currentValue += step;
                        } else {
                            currentValue -= step;
                        }

                        if (currentValue < min) {
                            currentValue = min;
                        }
                        
                        if (step < 1) {
                            input.value = currentValue.toFixed(2);
                        } else {
                            input.value = currentValue;
                        }
                        input.dispatchEvent(new Event('change', { bubbles: true }));
                    }

                    if (e.target.closest('.select-package-btn')) {
                        const packageCard = e.target.closest('.package-card');
                        const packageId = packageCard.dataset.packageId;
                        selectPackage(packageId);
                    }
                    
                    if (e.target.closest('.delete-custom-package-btn')) {
                        const packageCard = e.target.closest('.package-card');
                        const packageId = packageCard.dataset.packageId;
                        if (confirm(`確定要刪除自訂方案 "${allPackages[packageId].name}" 嗎？`)) {
                            deleteCustomPackage(packageId);
                        }
                    }

                    if (e.target.closest('.compare-btn')) {
                        const btn = e.target.closest('.compare-btn');
                        const packageId = btn.closest('.package-card').dataset.packageId;
                        toggleCompare(packageId, btn);
                    }
                });
                
                document.getElementById('save-as-package').addEventListener('click', saveCurrentSelectionAsPackage);
                document.getElementById('clear-comparison').addEventListener('click', clearComparison);
            }
            
            function selectPackage(packageId) {
                clearQuoteSelections();
                
                const packageInfo = allPackages[packageId];
                if (!packageInfo) return;

                currentPackage = packageId;
                document.querySelector(`.package-card[data-package-id="${packageId}"]`)?.classList.add('selected');

                packageInfo.items.forEach(itemState => {
                    const container = document.querySelector(`div[data-service-id="${itemState.id}"]`);
                    if (!container) return;

                    const mainCheckbox = container.querySelector('.service-checkbox');
                    if (mainCheckbox) mainCheckbox.checked = itemState.mainChecked;
                    
                    const renewalCheckbox = container.querySelector('.renewal-checkbox');
                    if (renewalCheckbox) renewalCheckbox.checked = itemState.renewalChecked;

                    for (const inputClass in itemState.inputs) {
                        const inputEl = container.querySelector(`.${inputClass}`);
                        if (inputEl) {
                            if(inputEl.type === 'checkbox') {
                                inputEl.checked = itemState.inputs[inputClass];
                            } else {
                                inputEl.value = itemState.inputs[inputClass];
                            }
                        }
                    }
                });
                
                updateQuote();
            }

            function saveCurrentSelectionAsPackage() {
                const nameInput = document.getElementById('new-package-name');
                const name = nameInput.value.trim();
                if (!name) {
                    alert('請為您的組合方案命名。');
                    nameInput.focus();
                    return;
                }

                const itemsState = [];
                document.querySelectorAll('div[data-service-id]').forEach(container => {
                    const serviceId = container.dataset.serviceId;
                    const mainCheckbox = container.querySelector('.service-checkbox');
                    const renewalCheckbox = container.querySelector('.renewal-checkbox');

                    if ((mainCheckbox && mainCheckbox.checked) || (renewalCheckbox && renewalCheckbox.checked)) {
                        const itemState = {
                            id: serviceId,
                            mainChecked: mainCheckbox ? mainCheckbox.checked : false,
                            renewalChecked: renewalCheckbox ? renewalCheckbox.checked : false,
                            inputs: {}
                        };

                        const inputsToSave = container.querySelectorAll('.first-year-discount, .renewal-years, .renewal-discount, .inner-page-count, .language-count, .special-language-count, .chinese-blog-count, .english-blog-count, .mailcloud-quantity, .mailcloud-years, .description-input, .mailcloud-setup-check');
                        
                        inputsToSave.forEach(input => {
                            const key = input.classList[0] || input.id;
                            if (input.type === 'checkbox') {
                                itemState.inputs[key] = input.checked;
                            } else {
                                itemState.inputs[key] = input.value;
                            }
                        });
                        itemsState.push(itemState);
                    }
                });

                if (itemsState.length === 0) {
                    alert("沒有選擇任何項目，無法儲存。");
                    return;
                }

                const packageId = 'custom-' + Date.now();
                const newPackage = {
                    id: packageId,
                    name: name,
                    items: itemsState,
                    isCustom: true
                };

                allPackages[packageId] = newPackage;
                localStorage.setItem('customQuotePackages', JSON.stringify(allPackages));
                renderCustomPackage(newPackage);
                nameInput.value = ''; // Clear input
                alert(`組合方案 "${newPackage.name}" 已儲存！`);
            }

            function renderCustomPackage(packageData) {
                const container = document.getElementById('packages-container');
                const card = document.createElement('div');
                card.className = 'package-card border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-all duration-300 relative flex flex-col';
                card.dataset.packageId = packageData.id;

                const itemsHTML = packageData.items.map(item => {
                    const serviceContainer = document.querySelector(`[data-service-id="${item.id}"]`);
                    if (!serviceContainer) return '';
                    
                    let itemHTML = '';
                    if (item.mainChecked) {
                        const name = serviceContainer.querySelector('.service-checkbox').dataset.name;
                        itemHTML += `<li>${name}</li>`;
                    }
                    if (item.renewalChecked) {
                        const name = serviceContainer.querySelector('.renewal-checkbox').dataset.name;
                        const years = item.inputs['renewal-years'] || 1;
                        itemHTML += `<li>${name} (${years}年)</li>`;
                    }
                    return itemHTML;
                }).join('');

                card.innerHTML = `
                    <button class="delete-custom-package-btn absolute top-3 left-3 text-gray-400 hover:text-red-500 transition-colors z-10">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                    <div class="absolute top-4 right-4 bg-gray-500 text-white text-xs font-bold px-2 py-1 rounded-full">自訂方案</div>
                    <h3 class="text-xl font-bold text-gray-700">${packageData.name}</h3>
                    <ul class="list-disc list-inside mt-4 text-gray-600 space-y-2 text-sm flex-grow">${itemsHTML}</ul>
                    <div class="mt-auto pt-4 text-right">
                        <button class="mt-2 w-full bg-yellow-400 text-yellow-800 px-4 py-1.5 rounded-lg hover:bg-yellow-500 transition-colors text-sm font-bold compare-btn">
                            <i class="fas fa-balance-scale-right mr-2"></i>加入比較
                        </button>
                        <button class="mt-3 bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 w-full select-package-btn">選擇此方案</button>
                    </div>
                `;
                container.appendChild(card);
            }
            
            function loadCustomPackages() {
                const savedPackages = JSON.parse(localStorage.getItem('customQuotePackages') || '{}');
                Object.keys(savedPackages).forEach(key => {
                    if (savedPackages[key].isCustom) {
                        allPackages[key] = savedPackages[key];
                        renderCustomPackage(savedPackages[key]);
                    }
                });
            }

            function deleteCustomPackage(packageId) {
                document.querySelector(`[data-package-id="${packageId}"]`).remove();
                delete allPackages[packageId];
                localStorage.setItem('customQuotePackages', JSON.stringify(allPackages));
                updateQuote();
            }
            
            function generateQuoteInfo() {
                const now = new Date();
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');

                const quoteNumber = `${year}${month}${day}${hours}${minutes}`;
                const today = `${year}-${month}-${day}`;

                document.getElementById('cust-quote-num').value = quoteNumber;
                document.getElementById('cust-date').value = today;
            }

            function calculatePackagePrice(packageId) {
                const packageInfo = allPackages[packageId];
                if (!packageInfo) return { totalPrice: 0, totalYears: 1 };

                let totalCost = 0;
                let maxYears = 1;

                packageInfo.items.forEach(itemState => {
                    const basePrice = priceStore[itemState.id]?.price || 0;
                    const renewalPrice = priceStore[itemState.id]?.renewal || 0;
                    
                    let itemFirstYear = 0;
                    let itemYears = 1;

                    if (itemState.mainChecked) {
                        const discount = parseFloat(itemState.inputs['first-year-discount']) || 1;
                        itemFirstYear = basePrice * discount;
                    }

                    if (itemState.renewalChecked) {
                        const years = parseInt(itemState.inputs['renewal-years']) || 1;
                        const discount = parseFloat(itemState.inputs['renewal-discount']) || 1;
                        totalCost += itemFirstYear + (renewalPrice * years * discount);
                        itemYears = 1 + years;
                    } else {
                        totalCost += itemFirstYear;
                    }
                    maxYears = Math.max(maxYears, itemYears);
                });

                return { totalPrice: totalCost, totalYears: maxYears };
            }

            function toggleCompare(packageId, btn) {
                const index = comparisonList.indexOf(packageId);
                if (index > -1) {
                    comparisonList.splice(index, 1);
                    btn.classList.remove('added');
                    btn.innerHTML = `<i class="fas fa-balance-scale-right mr-2"></i>加入比較`;
                } else {
                    comparisonList.push(packageId);
                    btn.classList.add('added');
                    btn.innerHTML = `<i class="fas fa-check mr-2"></i>已加入比較`;
                }
                updateComparisonTable();
            }

            function updateComparisonTable() {
                if (comparisonList.length === 0) {
                    comparisonSection.classList.add('hidden');
                    return;
                }
                comparisonSection.classList.remove('hidden');
                comparisonTbody.innerHTML = '';

                const packageDetails = comparisonList.map(id => {
                    const details = calculatePackagePrice(id);
                    const averageCost = details.totalPrice / details.totalYears;
                    return { id, name: allPackages[id].name, averageCost };
                });

                const maxAverageCost = Math.max(...packageDetails.map(p => p.averageCost));

                packageDetails.forEach(detail => {
                    const savings = maxAverageCost - detail.averageCost;
                    const row = document.createElement('tr');
                    row.className = 'border-b';
                    row.innerHTML = `
                        <td class="p-2 font-semibold">${detail.name}</td>
                        <td class="p-2">NT$ ${Math.round(detail.averageCost).toLocaleString()} /年</td>
                        <td class="p-2 text-green-600">${savings > 0 ? `省 ${Math.round(savings).toLocaleString()}` : '-'}</td>
                        <td class="p-2"><button class="text-red-500 hover:text-red-700 remove-from-compare" data-id="${detail.id}">&times;</button></td>
                    `;
                    comparisonTbody.appendChild(row);
                });

                document.querySelectorAll('.remove-from-compare').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const idToRemove = e.target.dataset.id;
                        const btnToReset = document.querySelector(`.package-card[data-package-id="${idToRemove}"] .compare-btn`);
                        toggleCompare(idToRemove, btnToReset);
                    });
                });
            }

            function clearComparison() {
                comparisonList = [];
                document.querySelectorAll('.compare-btn').forEach(btn => {
                    btn.classList.remove('added');
                    btn.innerHTML = `<i class="fas fa-balance-scale-right mr-2"></i>加入比較`;
                });
                updateComparisonTable();
            }

            function initialize() {
                const savedPrices = JSON.parse(localStorage.getItem('customPriceStore') || '{}');
                
                populatePriceSettings(); // Populate with defaults first
                Object.assign(priceStore, savedPrices); // Then overwrite with saved data
                
                // Re-apply saved prices to the UI
                Object.keys(priceStore).forEach(serviceId => {
                    if (priceStore[serviceId].price !== undefined) {
                        const input = document.querySelector(`#price-edit-${serviceId}`);
                        if (input) input.value = priceStore[serviceId].price;
                        const display = document.querySelector(`.price-display[data-price-id="${serviceId}"]`);
                        if (display) display.textContent = `NT$ ${priceStore[serviceId].price.toLocaleString()}`;
                    }
                    if (priceStore[serviceId].renewal !== undefined) {
                         const input = document.querySelector(`#price-edit-renewal-${serviceId}`);
                        if (input) input.value = priceStore[serviceId].renewal;
                        const display = document.querySelector(`.renewal-price-display[data-renewal-price-id="${serviceId}"]`);
                        if(display) display.textContent = `NT$ ${priceStore[serviceId].renewal.toLocaleString()} /年`;
                    }
                });

                loadCustomPackages();
                setupAllListeners();
                generateQuoteInfo();
                updateQuote();
            }

            initialize();
            
            // --- Other Event Listeners ---
            document.getElementById('clear-quote').addEventListener('click', clearQuoteSelections);

            document.getElementById('clear-customer-info').addEventListener('click', function() {
                document.getElementById('cust-name').value = '';
                document.getElementById('cust-contact').value = '';
                document.getElementById('cust-tel').value = '';
                document.getElementById('cust-email').value = '';
                document.getElementById('cust-tax-id').value = '';
                document.getElementById('cust-address').value = '';
                generateQuoteInfo();
            });

            document.getElementById('add-custom-item').addEventListener('click', function() {
                const nameInput = document.getElementById('custom-item-name');
                const priceInput = document.getElementById('custom-item-price');
                const name = nameInput.value.trim();
                const price = parseFloat(priceInput.value);

                if (!name || isNaN(price)) {
                    alert('請輸入有效的項目名稱和價格。');
                    return;
                }

                const customId = 'custom-' + Date.now();
                const additionalServicesContainer = document.getElementById('additional-services');

                const newServiceHTML = `
                    <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="${customId}">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-700">${name}</h3>
                            </div>
                            <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-gray-600 focus:ring-gray-500 cursor-pointer ml-4" 
                                   data-name="${name}" data-price="${price}" data-renewal="0">
                        </div>
                        <div class="mt-2">
                            <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                        </div>
                        <div class="mt-4 flex justify-end items-baseline gap-6">
                           <p class="text-gray-500">一次性費用</p>
                           <p class="text-gray-800">費用: <span class="font-bold text-2xl text-gray-600 price-display" data-price-id="${customId}">${price === 0 ? '<span class="text-green-600">特別優惠贈送</span>' : `NT$ ${price.toLocaleString()}`}</span></p>
                        </div>
                    </div>
                `;
                
                additionalServicesContainer.insertAdjacentHTML('beforeend', newServiceHTML);

                priceStore[customId] = { price: price, renewal: 0 };
                localStorage.setItem('customPriceStore', JSON.stringify(priceStore));


                const settingsContainer = document.getElementById('price-settings-container');
                const settingRow = document.createElement('div');
                settingRow.className = 'flex justify-between items-center py-2 border-b';
                settingRow.innerHTML = `
                    <label for="price-edit-${customId}" class="text-sm">${name}</label>
                    <input type="number" id="price-edit-${customId}" data-target-id="${customId}" data-price-type="price" class="form-input w-32 highlight-input" value="${price}">
                `;
                settingsContainer.appendChild(settingRow);
                addPriceSettingListeners(settingRow);

                setupAllListeners(); // Re-run to attach listener to new item

                nameInput.value = '';
                priceInput.value = '';
                document.querySelector('[data-tab="additional-services"]').click();
            });

            // --- Print Functionality ---
            document.getElementById('print-quote').addEventListener('click', function() {
                if (document.querySelectorAll('.service-checkbox:checked, .renewal-checkbox:checked').length === 0) {
                    alert('請至少選擇一個報價項目後再列印。');
                    return;
                }

                const pmName = document.getElementById('project-manager-name').value;
                const pmPhone = document.getElementById('project-manager-phone').value;
                const pmEmail = document.getElementById('project-manager-email').value;

                const custQuoteNum = document.getElementById('cust-quote-num').value || 'N/A';
                const custDate = document.getElementById('cust-date').value ? new Date(document.getElementById('cust-date').value).toLocaleDateString('zh-TW') : 'N/A';
                const custName = document.getElementById('cust-name').value || 'N/A';
                const custContact = document.getElementById('cust-contact').value || 'N/A';
                const custTel = document.getElementById('cust-tel').value || 'N/A';
                const custEmail = document.getElementById('cust-email').value || 'N/A';
                const custTaxId = document.getElementById('cust-tax-id').value || 'N/A';
                const custAddress = document.getElementById('cust-address').value || 'N/A';

                const grandTotalText = document.getElementById('grand-total').textContent;
                const monthlyAverageText = document.getElementById('monthly-average').textContent;
                const includeTax = document.getElementById('include-tax-checkbox').checked;
                
                let taxedTotalHTML = '';
                if (includeTax) {
                    const totalCost = parseFloat(grandTotalText.replace(/[^0-9.-]+/g,""));
                    const taxedTotal = totalCost * 1.05;
                    taxedTotalHTML = `
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-lg font-bold">方案總價 (含稅)</span>
                            <span class="font-bold text-2xl text-red-600">NT$ ${Math.round(taxedTotal).toLocaleString()}</span>
                        </div>
                    `;
                }
                
                const printItemsHTML = document.getElementById('quote-summary').innerHTML;
                const comparisonTableHTML = comparisonSection.classList.contains('hidden') ? '' : comparisonSection.outerHTML;

                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>崴浤科技股份有限公司 - 報價單</title>
                            <script src="https://cdn.tailwindcss.com"><\/script>
                            <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
                            <style>
                                body { font-family: 'Noto Sans TC', sans-serif; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
                                @page { size: A4; margin: 1.5cm; }
                                .break-inside-avoid { break-inside: avoid; }
                                ul { padding-left: 1.5rem; }
                                li { margin-top: 0.25rem; }
                                #comparison-section { display: block !important; }
                                .delete-custom-package-btn, .remove-from-compare { display: none; }
                            </style>
                        </head>
                        <body class="p-4">
                            <header class="mb-8 flex justify-between items-start">
                                <div>
                                    <h1 class="text-2xl font-bold text-gray-800">崴浤科技股份有限公司</h1>
                                    <p class="text-gray-500 text-sm">網站設計 & SEO 優化方案報價單</p>
                                </div>
                                <div class="text-sm text-gray-700">
                                    <div class="grid grid-cols-[auto_1fr] gap-x-2 text-left">
                                        <strong class="font-semibold">專案人員:</strong>
                                        <span>${pmName}</span>
                                        <strong class="font-semibold">電話:</strong>
                                        <span>${pmPhone}</span>
                                        <strong class="font-semibold">Email:</strong>
                                        <span>${pmEmail}</span>
                                    </div>
                                </div>
                            </header>
                            
                            <div class="mb-8 p-4 border rounded-lg bg-gray-50">
                                 <h2 class="text-lg font-bold mb-3">報價資訊</h2>
                                 <div class="grid grid-cols-[auto_1fr_auto_1fr] gap-x-4 gap-y-2 text-sm items-baseline">
                                    <strong class="font-semibold text-left">報價單號：</strong>
                                    <p>${custQuoteNum}</p>
                                    <strong class="font-semibold text-left">公司名稱：</strong>
                                    <p>${custName}</p>
                                    
                                    <strong class="font-semibold text-left">報價日期：</strong>
                                    <p>${custDate}</p>
                                    <strong class="font-semibold text-left">聯絡人：</strong>
                                    <p>${custContact}</p>

                                    <strong class="font-semibold text-left">電話：</strong>
                                    <p>${custTel}</p>
                                    <strong class="font-semibold text-left">Email：</strong>
                                    <p>${custEmail}</p>

                                    <strong class="font-semibold text-left">統一編號：</strong>
                                    <p>${custTaxId}</p>
                                    <strong class="font-semibold text-left">地址：</strong>
                                    <p>${custAddress}</p>
                                </div>
                            </div>

                            <div class="mb-8" style="page-break-after: avoid;">
                                <h2 class="text-lg font-bold mb-3">報價項目</h2>
                                <div class="border rounded-lg p-4">
                                    ${printItemsHTML}
                                </div>
                            </div>

                            <footer class="flex justify-end break-inside-avoid">
                                <div class="w-full md:w-2/3 lg:w-1/2 p-6 bg-gray-50 rounded-lg">
                                    ${comparisonTableHTML}
                                    <div class="space-y-2 mb-4 border-t border-gray-200 pt-4 mt-4">
                                         <div class="flex justify-between items-center text-gray-600">
                                            <span>平均每月金額</span>
                                            <span id="monthly-average" class="font-semibold text-lg">${monthlyAverageText}</span>
                                        </div>
                                    </div>
                                    <div class="border-t border-gray-200 pt-4 space-y-2">
                                        <div class="flex justify-between items-center">
                                            <span class="text-xl font-bold">方案總價 (未稅)</span>
                                            <span class="font-bold text-2xl text-blue-600">${grandTotalText}</span>
                                        </div>
                                        ${taxedTotalHTML}
                                    </div>
                                </div>
                            </footer>
                        </body>
                    </html>
                `);
                
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.print();
                    printWindow.close();
                }, 250);
            });
        });
    </script>
</body>
</html>
