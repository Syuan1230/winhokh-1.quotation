<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互動式網站設計報價單 - 崴浤科技</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f7fafc;
        }
        .nav-link.active {
            border-bottom-color: #3b82f6;
            color: #2563eb;
            font-weight: 700;
        }
        .tab-content {
            transition: opacity 0.5s ease-in-out;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .form-input {
            @apply px-3 py-2 border border-gray-300 rounded-md w-full;
        }
        .number-input-wrapper {
            @apply flex items-center;
        }
        .number-input {
            -moz-appearance: textfield;
            @apply w-12 h-8 text-center border-t-2 border-b-2 border-black focus:outline-none focus:ring-0 font-bold bg-yellow-100;
        }
        .number-input::-webkit-inner-spin-button,
        .number-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .stepper-btn {
            @apply bg-gray-200 w-8 h-8 flex items-center justify-center font-extrabold text-lg text-gray-700 hover:bg-gray-300 transition-colors duration-200 border-2 border-black;
        }
        .stepper-btn.minus {
            @apply rounded-l-md border-r-0;
        }
        .stepper-btn.plus {
            @apply rounded-r-md border-l-0;
        }
        .package-card.selected {
            @apply ring-4 ring-offset-2 ring-blue-500;
        }
        .compare-btn.added {
            @apply bg-yellow-500 text-white;
        }
        .features-list ul {
            list-style-position: inside;
            padding-left: 0.5rem;
        }
        .features-list li {
            margin-top: 0.25rem;
        }
        [contenteditable="true"] {
            @apply p-1 rounded hover:bg-gray-100 focus:bg-blue-50 focus:ring-1 focus:ring-blue-300 outline-none transition-colors;
        }

        /* Print-specific styles */
        @media print {
            .no-print {
                display: none !important;
            }
            body {
                background-color: white !important;
            }
            .print-container {
                width: 100%;
                box-shadow: none !important;
                margin: 0;
                padding: 0;
            }
            .price-col {
                display: table-cell;
            }
            .print-hide-price .price-col {
                display: none;
            }
        }
        @page {
            size: A4;
            margin: 1.5cm;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Price Settings Modal -->
    <div id="price-settings-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-40 hidden no-print">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold">價格調整控制台</h2>
                <button id="close-price-settings" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="price-settings-container" class="space-y-3 overflow-y-auto flex-grow">
                <!-- Price adjustment inputs will be generated here by JavaScript -->
            </div>
             <div class="mt-6 border-t pt-4">
                <h3 class="text-lg font-semibold mb-2">新增自訂義項目</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="text" id="custom-item-name" placeholder="項目名稱" class="form-input">
                    <input type="number" id="custom-item-price" placeholder="項目價格" class="form-input">
                    <button id="add-custom-item" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">新增項目</button>
                </div>
            </div>
        </div>
    </div>


    <div id="app-container">
        <div class="container mx-auto p-4 md:p-8">
            
            <!-- Editable Header -->
            <header class="bg-white p-6 rounded-xl shadow-md mb-8 no-print">
                 <div class="flex justify-between items-start">
                    <div class="grid md:grid-cols-2 gap-6 w-full">
                        <div class="flex items-center gap-4">
                            <img src="https://www.winho.com.tw/uploadfiles/338/images-new/winho-logo5.png" alt="崴浤科技 LOGO" class="h-12 md:h-14">
                            <div>
                                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">崴浤科技股份有限公司</h1>
                                <p class="text-gray-500 text-sm">網站設計 & SEO 優化方案</p>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center gap-4">
                                <label for="project-manager-name" class="text-sm font-medium text-gray-700 w-20 flex-shrink-0 text-right">客戶經理</label>
                                <input type="text" id="project-manager-name" value="" placeholder="專案人員姓名" class="form-input text-sm">
                            </div>
                            <div class="flex items-center gap-4">
                                <label for="project-manager-phone" class="text-sm font-medium text-gray-700 w-20 flex-shrink-0 text-right">聯絡方式</label>
                                <input type="text" id="project-manager-phone" value="" placeholder="專案人員電話" class="form-input text-sm">
                            </div>
                            <div class="flex items-center gap-4">
                                <label for="project-manager-email" class="text-sm font-medium text-gray-700 w-20 flex-shrink-0 text-right">Email</label>
                                <input type="email" id="project-manager-email" value="" placeholder="專案人員Email" class="form-input text-sm">
                            </div>
                        </div>
                    </div>
                    <button id="open-price-settings" class="ml-4 text-gray-500 hover:text-blue-600 transition-colors">
                        <i class="fas fa-cog fa-2x"></i>
                    </button>
                </div>
            </header>
            
            <!-- Customer Info Form -->
            <div id="customer-info-form" class="bg-white p-6 rounded-xl shadow-md mb-8 no-print">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">客戶資料 (列印用)</h3>
                    <button id="clear-customer-info" class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 text-sm">
                        <i class="fas fa-user-times mr-1"></i>清空客戶資料
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <input type="text" id="cust-quote-num" placeholder="報價單號" class="form-input bg-gray-100" readonly>
                    <input type="date" id="cust-date" class="form-input bg-gray-100" readonly>
                    <input type="text" id="cust-name" placeholder="公司名稱" class="form-input">
                    <input type="text" id="cust-contact" placeholder="聯絡人" class="form-input">
                    <input type="text" id="cust-tel" placeholder="電話" class="form-input">
                    <input type="text" id="cust-email" placeholder="Email" class="form-input">
                    <input type="text" id="cust-tax-id" placeholder="統一編號" class="form-input">
                    <input type="text" id="cust-address" placeholder="地址" class="form-input">
                </div>
            </div>

            <!-- NEW: Payment Method & Remarks -->
            <div id="payment-info-form" class="bg-white p-6 rounded-xl shadow-md mb-8 no-print">
                <h3 class="text-xl font-bold text-gray-800 mb-4">付款方式及備註 (列印用)</h3>
                <textarea id="payment-method-notes" class="form-input w-full h-24" placeholder="請在此輸入付款方式、合約條款或其他備註事項..."></textarea>
            </div>


            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Main Content -->
                <main class="w-full lg:w-2/3">
                    <nav class="bg-white rounded-t-xl shadow-md no-print">
                        <div class="flex border-b border-gray-200 overflow-x-auto no-scrollbar">
                            <a href="#" class="nav-link active text-sm md:text-base p-4 border-b-2 border-transparent hover:border-blue-500 hover:bg-gray-50 whitespace-nowrap" data-tab="combo-packages">組合方案</a>
                            <a href="#" class="nav-link text-sm md:text-base p-4 border-b-2 border-transparent hover:border-blue-500 hover:bg-gray-50 whitespace-nowrap" data-tab="website-design">網站設計</a>
                            <a href="#" class="nav-link text-sm md:text-base p-4 border-b-2 border-transparent hover:border-blue-500 hover:bg-gray-50 whitespace-nowrap" data-tab="seo-marketing">SEO 行銷</a>
                            <a href="#" class="nav-link text-sm md:text-base p-4 border-b-2 border-transparent hover:border-blue-500 hover:bg-gray-50 whitespace-nowrap" data-tab="premium-package">頂級方案</a>
                            <a href="#" class="nav-link text-sm md:text-base p-4 border-b-2 border-transparent hover:border-blue-500 hover:bg-gray-50 whitespace-nowrap" data-tab="additional-services">加購服務</a>
                        </div>
                    </nav>

                    <div class="bg-white p-6 rounded-b-xl shadow-md no-print">
                        
                        <!-- Combo Packages Tab -->
                        <div id="combo-packages" class="tab-content space-y-8">
                            <!-- Custom Packages Container -->
                            <div id="packages-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Custom packages will be injected here -->
                            </div>
                        </div>

                        <!-- Website Design Tab -->
                        <div id="website-design" class="tab-content hidden space-y-6">
                            
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="project-design">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-blue-700">專案設計</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">打造獨一無二的高質感品牌網站，提供全方位規劃服務。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-blue-600 focus:ring-blue-500 cursor-pointer ml-4" 
                                           data-name="專案設計" data-price="398000">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>專案經理輔助：</b>搭配專案經理輔助專案執行 (視訊溝通+3次外訪)</li>
                                    <li><b>專案流程規劃：</b>專案流程及設計時程規劃／設計及修改進度跟催／資料準備清單</li>
                                    <li><b>客製設計：</b>客製首頁提版設計1款，首頁每區塊設計師提出流行素材案例</li>
                                    <li><b>動態首頁：</b>動態全景式首頁（首頁Banner＊3、內頁Banner＊1）</li>
                                    <li><b>頁面設計：</b>首頁"五大主題"區域設計 + 內頁主選項頁面設計"5頁"</li>
                                    <li><b>商用圖庫：</b>123RF / iStock 圖庫 20 張（限網頁設計使用版權商用圖庫）</li>
                                    <li><b>技術規格：</b>全站 RWD 響應式網頁，語言版本：中文＆英文</li>
                                </ul>
                                <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-blue-600 price-display" data-price-id="project-design">NT$ 398,000</span></p>
                                </div>
                                <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-1" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-blue-600 focus:ring-blue-500 cursor-pointer" 
                                                   data-renewal-price="48000" data-name="專案設計 - 續約">
                                            <label for="renewal-check-1" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="project-design">NT$ 48,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- UPDATED: Basic Custom Image Design -->
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="basic-design">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-green-700">基礎形象客製設計</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">風格提版以風格頁設計為主(首頁一頁、內頁各一頁),修改次數以兩次為限,超過費用另計。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-green-600 focus:ring-green-500 cursor-pointer ml-4" 
                                           data-name="基礎形象客製設計" data-price="200000">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>設計範圍：</b>首頁Banner大圖*2,內頁banner*1 (含手機Banner排版)。</li>
                                    <li><b>版面規劃：</b>首頁區塊限制 4區(含banner橫幅)，內頁設計範圍依照內頁設計範例說明。</li>
                                    <li><b>行動裝置：</b>含手機選單設計。</li>
                                    <li><b>語系版本：</b>中文、英文。</li>
                                    <li><b>版權圖庫：</b>123RF or iStock 版權圖庫 *10張，圖庫僅提供設計使用,因版權問題不另行提供原始檔下載。</li>
                                    <li><b>功能列表：</b>產品展示、SEO搜尋引擎最佳化、系統管理、詢報價管理(B)、聯絡我們、檔案管理、訊息管理、社群管理、會員管理(如需權限管理另行報價)、廣告管理、客問答、檔案下載、網站連結。</li>
                                    <li><b>技術規格：</b>全面支援Google WebP 次世代圖片格式、DDoS 雙雲端平台攻擊防護(GCP+Azure)、圖片資料7天完整備份,資料庫30天完整備份, AWS雲端異地備份、Winho WAF 五大洲頂級應用程式防火牆。</li>
                                </ul>
                                <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-green-600 price-display" data-price-id="basic-design">NT$ 200,000</span></p>
                                </div>
                                 <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-2" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-green-600 focus:ring-green-500 cursor-pointer" 
                                                   data-renewal-price="20000" data-name="基礎形象客製設計 - 續約">
                                            <label for="renewal-check-2" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="basic-design">NT$ 20,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- NEW: Exquisite Custom Image Design -->
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="exquisite-design">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-yellow-700">精緻形象客製設計</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">風格提版以風格頁設計為主(首頁一頁、內頁兩頁),修改次數以兩次為限,超過費用另計。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-yellow-600 focus:ring-yellow-500 cursor-pointer ml-4" 
                                           data-name="精緻形象客製設計" data-price="298000">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>設計範圍：</b>首頁Banner大圖*2,內頁banner*1 (含手機Banner排版)。</li>
                                    <li><b>版面規劃：</b>首頁區塊限制 6區(含banner橫幅)，內頁設計範圍依照內頁設計範例說明。</li>
                                    <li><b>行動裝置：</b>含手機選單設計。</li>
                                    <li><b>語系版本：</b>中文、英文。</li>
                                    <li><b>版權圖庫：</b>123RF or iStock 版權圖庫 *10張，圖庫僅提供設計使用,因版權問題不另行提供原始檔下載。</li>
                                    <li><b>功能列表：</b>產品展示、SEO搜尋引擎最佳化、系統管理、詢報價管理(B)、聯絡我們、檔案管理、訊息管理、社群管理、會員管理(如需權限管理另行報價)、廣告管理、客問答、檔案下載、網站連結。</li>
                                    <li><b>技術規格：</b>全面支援Google WebP 次世代圖片格式、DDoS 雙雲端平台攻擊防護(GCP+Azure)、圖片資料7天完整備份,資料庫30天完整備份, AWS雲端異地備份、Winho WAF 五大洲頂級應用程式防火牆。</li>
                                </ul>
                                <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-yellow-600 price-display" data-price-id="exquisite-design">NT$ 298,000</span></p>
                                </div>
                                 <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-exquisite" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-yellow-600 focus:ring-yellow-500 cursor-pointer" 
                                                   data-renewal-price="30000" data-name="精緻形象客製設計 - 續約">
                                            <label for="renewal-check-exquisite" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="exquisite-design">NT$ 30,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="winshop-template">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-purple-700">Winshop 新公版</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">更具彈性的模組化公版，自由組合出 125 種獨特樣式。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-purple-600 focus:ring-purple-500 cursor-pointer ml-4" 
                                           data-name="Winshop新公版" data-price="128000">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>Banner設計：</b>首頁Banner＊2、內頁Banner＊1</li>
                                    <li><b>背景設計：</b>首頁區塊背景設計（公司簡介圖片＆背景圖、產品背景圖、最新消息背景圖）</li>
                                    <li><b>模組化版型：</b>首頁版型-開發版型模組選擇：公司簡介、產品介紹、最新消息</li>
                                    <li><b>內頁版型：</b>內頁版型-開發版型模組選擇：產品介紹、聯絡我們</li>
                                    <li><b>彈性組合：</b>每個模組提供5種選擇，可組合為125種樣式</li>
                                    <li><b>商用圖庫：</b>123RF / iStock圖庫10張（限網頁設計使用版權商用圖庫）</li>
                                </ul>
                                <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-purple-600 price-display" data-price-id="winshop-template">NT$ 128,000</span></p>
                                </div>
                                <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-3" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-purple-600 focus:ring-purple-500 cursor-pointer" 
                                                   data-renewal-price="20000" data-name="Winshop 新公版 - 續約">
                                            <label for="renewal-check-3" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="winshop-template">NT$ 20,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                         <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- SEO Marketing Tab -->
                        <div id="seo-marketing" class="tab-content hidden space-y-6">
                            
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="seo-cross-border">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-red-700">跨國 SEO 行銷優化服務</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">拓展全球業務，讓世界看見您的品牌。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-red-600 focus:ring-red-500 cursor-pointer ml-4" 
                                           data-name="跨國SEO行銷優化服務" data-price="300000">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>優化目標：</b>Google.com 搜尋引擎優化（英文）+ Google.com.tw 搜尋引擎優化（中文）</li>
                                    <li><b>關鍵字：</b>可同時優化中文+英文關鍵字，合計優化 20 組關鍵字</li>
                                    <li><b>關鍵字規劃：</b>關鍵字分析、評估、挑選，20組連結頁面重點優化</li>
                                    <li><b>技術優化：</b>結構化／多國語系／網址／sitemap／Robots等</li>
                                    <li><b>內容優化：</b>META／ALT／H標籤／文案／內容優化調整建議／社群等</li>
                                    <li><b>全球主機：</b>五大洲多節點智能主機（外銷升級），提升國際使用者體驗</li>
                                    <li><b>成效追蹤：</b>每月提供關鍵字排名報表，串接 GA4、GSC 數據分析工具</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-red-600 price-display" data-price-id="seo-cross-border">NT$ 300,000</span></p>
                                </div>
                                <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-4" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-red-600 focus:ring-red-500 cursor-pointer" 
                                                   data-renewal-price="250000" data-name="跨國 SEO - 續約">
                                            <label for="renewal-check-4" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="seo-cross-border">NT$ 250,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="seo-chinese">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-teal-700">中文 SEO 行銷優化服務</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">深耕在地市場，精準觸及台灣客戶。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-teal-600 focus:ring-teal-500 cursor-pointer ml-4" 
                                           data-name="中文SEO行銷優化服務" data-price="250000">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>優化目標：</b>Google.com.tw 搜尋引擎優化</li>
                                    <li><b>關鍵字：</b>可優化中文關鍵字合計共 20 組</li>
                                    <li><b>關鍵字規劃：</b>關鍵字分析、評估、挑選，20組連結頁面重點優化</li>
                                    <li><b>技術優化：</b>結構化／多國語系／網址／sitemap／Robots等</li>
                                    <li><b>內容優化：</b>META／ALT／H標籤／文案／內容優化調整建議／社群等</li>
                                    <li><b>在地化提交：</b>提交至 Google（桌機、手機版）、BING 搜尋引擎</li>
                                    <li><b>成效追蹤：</b>每月提供關鍵字排名報表，串接 GA4、GSC 數據分析工具</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-center gap-4">
                                   <div>
                                        <label class="text-sm text-gray-600">首年折扣</label>
                                        <div class="number-input-wrapper">
                                            <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                            <input type="number" value="1" step="0.01" min="0" class="first-year-discount number-input">
                                            <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                        </div>
                                   </div>
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-teal-600 price-display" data-price-id="seo-chinese">NT$ 250,000</span></p>
                                </div>
                                 <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-5" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-teal-600 focus:ring-teal-500 cursor-pointer" 
                                                   data-renewal-price="200000" data-name="中文 SEO - 續約">
                                            <label for="renewal-check-5" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="seo-chinese">NT$ 200,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Premium Package Tab -->
                        <div id="premium-package" class="tab-content hidden space-y-6">
                            
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="premium-chinese">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-orange-700">專案行銷頂級方案 (中文SEO)</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">專案設計+中文SEO頂級整合方案，加量不加價。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-orange-600 focus:ring-orange-500 cursor-pointer ml-4" 
                                           data-name="專案行銷頂級方案(中文SEO)" data-price="700000">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>Winshop系統：</b>Winshop 系統核心，語系開版1款</li>
                                    <li><b>視覺設計：</b>首頁視覺風格設計2款（電腦版、手機版），3張首頁橫幅廣告banner設計</li>
                                    <li><b>頁面設計：</b>內頁設計7頁（每頁最多5區塊，含banner橫幅）</li>
                                    <li><b>ESG功能：</b>ESG 訊息管理功能，設計切版1頁主頁、1頁內容</li>
                                    <li><b>內容撰寫：</b>部落格文案3篇</li>
                                    <li><b>手機版設計：</b>手機版選單設計一式</li>
                                    <li><b>動態特效：</b>首頁、內頁基礎動態特效</li>
                                    <li><b>專案服務：</b>專案、設計師一起執行視覺設計規劃，全方位專案追蹤服務</li>
                                    <li><b>SEO升級：</b>中文關鍵字30組（比一般方案多10組）</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-orange-600 price-display" data-price-id="premium-chinese">NT$ 700,000</span></p>
                                </div>
                                <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-6" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-orange-600 focus:ring-orange-500 cursor-pointer" 
                                                   data-renewal-price="248000" data-name="專案行銷頂級方案(中文SEO) - 續約">
                                            <label for="renewal-check-6" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="premium-chinese">NT$ 248,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="premium-english">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-indigo-700">專案行銷頂級方案 (英文SEO)</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">專案設計+英文SEO頂級整合方案，拓展國際市場。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-indigo-600 focus:ring-indigo-500 cursor-pointer ml-4" 
                                           data-name="專案行銷頂級方案(英文SEO)" data-price="750000">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>Winshop系統：</b>Winshop 系統核心，語系開版1款</li>
                                    <li><b>視覺設計：</b>首頁視覺風格設計2款（電腦版、手機版），3張首頁橫幅廣告banner設計</li>
                                    <li><b>頁面設計：</b>內頁設計7頁（每頁最多5區塊，含banner橫幅）</li>
                                    <li><b>ESG功能：</b>ESG 訊息管理功能，設計切版1頁主頁、1頁內容</li>
                                    <li><b>內容撰寫：</b>部落格文案3篇</li>
                                    <li><b>手機版設計：</b>手機版選單設計一式</li>
                                    <li><b>動態特效：</b>首頁、內頁基礎動態特效</li>
                                    <li><b>專案服務：</b>專案、設計師一起執行視覺設計規劃，全方位專案追蹤服務</li>
                                    <li><b>SEO升級：</b>英文關鍵字30組（比一般方案多10組）</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-800">首年: <span class="font-bold text-2xl text-indigo-600 price-display" data-price-id="premium-english">NT$ 750,000</span></p>
                                </div>
                                 <div class="mt-4 border-t pt-4 space-y-2 renewal-section">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="renewal-check-7" class="renewal-checkbox h-5 w-5 rounded border-gray-400 text-indigo-600 focus:ring-indigo-500 cursor-pointer" 
                                                   data-renewal-price="268000" data-name="專案行銷頂級方案(英文SEO) - 續約">
                                            <label for="renewal-check-7" class="font-semibold text-gray-700 cursor-pointer">續約服務</label>
                                        </div>
                                        <span class="font-semibold text-lg text-gray-600 renewal-price-display" data-renewal-price-id="premium-english">NT$ 268,000 /年</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pl-7">
                                        <div>
                                            <label class="text-sm text-gray-600">續約年份</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" value="1" min="1" class="renewal-years number-input">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-sm text-gray-600">續約折扣</label>
                                            <div class="number-input-wrapper">
                                                <button type="button" class="stepper-btn minus" data-step="0.01">-</button>
                                                <input type="number" value="1" step="0.01" min="0" class="renewal-discount number-input">
                                                <button type="button" class="stepper-btn plus" data-step="0.01">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Services Tab -->
                        <div id="additional-services" class="tab-content hidden space-y-6">
                            
                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-gray-700">HTTPS 安全加密</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">提供網站安全加密服務，提升網站安全等級。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-gray-600 focus:ring-gray-500 cursor-pointer ml-4" 
                                           data-name="HTTPS安全加密" data-price="6200" data-renewal="0">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>SSL憑證：</b>HTTPS 加密主機（SSL 憑證）</li>
                                    <li><b>最新技術：</b>最新升級 HTTP/3</li>
                                    <li><b>安全等級：</b>提升 HSTS 加密技術，系統安全 A+</li>
                                    <li><b>多語系：</b>其本語系：中、英、簡</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800">費用: <span class="font-bold text-2xl text-gray-600 price-display" data-price-id="">NT$ 6,200</span> <span class="text-sm text-green-600">(3年約贈送)</span></p>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="investor-relations">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-cyan-700">投資人專區</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">符合上市櫃公司投資人專區需求的專業模組。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-cyan-600 focus:ring-cyan-500 cursor-pointer ml-4" 
                                           data-name="投資人專區" data-price="40000" data-renewal="0">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>專業功能：</b>符合 80%上市櫃公司投資人專區需求</li>
                                    <li><b>搜尋設定：</b>搜尋設定、自訂表格設定等模組功能</li>
                                    <li><b>參考案例：</b>惠特科技 6706</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800">費用: <span class="font-bold text-2xl text-cyan-600 price-display" data-price-id="investor-relations">NT$ 40,000</span></p>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="inner-page-design">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-pink-700">內頁設計</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">單一頁面風格提版設計服務。</p>
                                        <div class="mt-2">
                                            <label class="text-sm text-gray-600">頁數：</label>
                                            <div class="number-input-wrapper inline-flex">
                                                <button type="button" class="stepper-btn minus">-</button>
                                                <input type="number" min="1" max="20" value="1" class="inner-page-count number-input" data-base-price="20000">
                                                <button type="button" class="stepper-btn plus">+</button>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-pink-600 focus:ring-pink-500 cursor-pointer ml-4" 
                                           data-name="內頁設計" data-price="20000" data-renewal="0">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>風格提版：</b>單一頁面（內頁）風格提版（不含Banner設計）</li>
                                    <li><b>文案效果：</b>僅編輯器內的文案效果，不抓取其他程式及動態效果</li>
                                    <li><b>語系費用：</b>僅收單一語系費用，其他語系套用無需額外費用</li>
                                    <li><b>響應式：</b>Layout 切版/RWD 響應式網頁效果</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800">費用: <span class="font-bold text-2xl text-pink-600 inner-page-total price-display" data-price-id="inner-page-design">NT$ 20,000</span> /頁</p>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="language-add">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-emerald-700">新增語系</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">為網站新增其他語言版本。</p>
                                        <div class="mt-2 space-y-2">
                                            <div class="flex items-center gap-2">
                                                <label class="text-sm text-gray-600 w-24">一般語系數量：</label>
                                                <div class="number-input-wrapper">
                                                    <button type="button" class="stepper-btn minus">-</button>
                                                    <input type="number" min="0" max="10" value="0" class="language-count number-input" data-price="8000">
                                                    <button type="button" class="stepper-btn plus">+</button>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <label class="text-sm text-gray-600 w-24">特殊語系數量：</label>
                                                <div class="number-input-wrapper">
                                                    <button type="button" class="stepper-btn minus">-</button>
                                                    <input type="number" min="0" max="10" value="0" class="special-language-count number-input" data-price="10000">
                                                    <button type="button" class="stepper-btn plus">+</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-emerald-600 focus:ring-emerald-500 cursor-pointer ml-4" 
                                           data-name="新增語系" data-price="0" data-renewal="0">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>一般語系：</b>網站建置每新增一語系 NT$ 8,000</li>
                                    <li><b>特殊語系：</b>如阿拉伯文（右至左排版）每語系 NT$ 10,000</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800 language-cost-p hidden">費用: <span class="font-bold text-2xl text-emerald-600 language-total">NT$ 0</span></p>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="blog-writing">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-violet-700">部落格文案撰寫</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">專業文案撰寫服務，提升網站內容品質。</p>
                                        <div class="mt-2 space-y-2">
                                            <div class="flex items-center gap-2">
                                                <label class="text-sm text-gray-600 w-24">中文文案篇數：</label>
                                                <div class="number-input-wrapper">
                                                    <button type="button" class="stepper-btn minus">-</button>
                                                    <input type="number" min="0" max="50" value="0" class="chinese-blog-count number-input" data-price="15000">
                                                    <button type="button" class="stepper-btn plus">+</button>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <label class="text-sm text-gray-600 w-24">英文文案篇數：</label>
                                                <div class="number-input-wrapper">
                                                    <button type="button" class="stepper-btn minus">-</button>
                                                    <input type="number" min="0" max="50" value="0" class="english-blog-count number-input" data-price="15000">
                                                    <button type="button" class="stepper-btn plus">+</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-violet-600 focus:ring-violet-500 cursor-pointer ml-4" 
                                           data-name="部落格文案撰寫" data-price="0" data-renewal="0">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>中文文案：</b>中文 1200 字文案撰寫 NT$ 15,000/篇</li>
                                    <li><b>英文文案：</b>英文 1200 字文案撰寫 NT$ 15,000/篇</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800 blog-cost-p hidden">費用: <span class="font-bold text-2xl text-violet-600 blog-total">NT$ 0</span></p>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="mailcloud">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-blue-700">MailCloud郵件代管(5G)</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">費用計算方式為 首次設定費1000，一組mail 1200/年。</p>
                                        <div class="mt-4 space-y-4">
                                            <div class="flex items-center gap-4">
                                                <input type="checkbox" id="mailcloud-setup-check" class="h-5 w-5 rounded border-gray-400 text-blue-600 focus:ring-blue-500 cursor-pointer mailcloud-setup-check">
                                                <label for="mailcloud-setup-check" class="text-gray-700 cursor-pointer">首次設定費</label>
                                            </div>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label class="text-sm text-gray-600">郵件帳號數量</label>
                                                    <div class="number-input-wrapper">
                                                        <button type="button" class="stepper-btn minus">-</button>
                                                        <input type="number" min="0" value="0" class="mailcloud-quantity number-input">
                                                        <button type="button" class="stepper-btn plus">+</button>
                                                    </div>
                                                </div>
                                                <div>
                                                    <label class="text-sm text-gray-600">使用年份</label>
                                                    <div class="number-input-wrapper">
                                                        <button type="button" class="stepper-btn minus">-</button>
                                                        <input type="number" min="0" value="0" class="mailcloud-years number-input">
                                                        <button type="button" class="stepper-btn plus">+</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-blue-600 focus:ring-blue-500 cursor-pointer ml-4" 
                                           data-name="MailCloud郵件代管(5G)" data-price="0" data-renewal="0">
                                </div>
                                <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">總計費用</p>
                                   <p class="text-gray-800 mailcloud-cost-p hidden">費用: <span class="font-bold text-2xl text-blue-600 mailcloud-total">NT$ 0</span></p>
                                </div>
                            </div>
                            
                             <div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="custom-dev">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-purple-700">客製程式</h3>
                                        <p contenteditable="true" class="text-gray-500 mt-1">依據需求客製化程式功能。</p>
                                    </div>
                                    <input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-purple-600 focus:ring-purple-500 cursor-pointer ml-4" 
                                           data-name="客製程式" data-price="0" data-renewal="0">
                                </div>
                                <ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2">
                                    <li><b>需求訪談：</b>與專案經理、工程師進行需求訪談。</li>
                                    <li><b>時程規劃：</b>根據功能複雜度規劃開發時程。</li>
                                    <li><b>功能交付：</b>分階段交付與測試客製化功能。</li>
                                </ul>
                                 <div class="mt-2">
                                    <textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea>
                                </div>
                                <div class="mt-4 flex justify-end items-baseline gap-6">
                                   <p class="text-gray-500">一次性費用</p>
                                   <p class="text-gray-800">費用: <span class="font-bold text-2xl text-purple-600 price-display" data-price-id="custom-dev">依工程師估價</span></p>
                                </div>
                            </div>
                        </div>

                        <!-- Price Settings Tab -->
                        <div id="price-settings" class="tab-content hidden space-y-4">
                            <h3 class="text-xl font-bold text-gray-800">調整項目價格</h3>
                            <div id="price-settings-container-main" class="space-y-3">
                                <!-- Price adjustment inputs will be generated here by JavaScript -->
                            </div>
                        </div>
                    </div>
                </main>

                <!-- Sidebar / Quote Summary -->
                <aside class="w-full lg:w-1/3 no-print">
                     <div class="bg-white rounded-xl shadow-md sticky top-8">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-xl font-bold flex items-center gap-3">
                                <i class="fas fa-file-invoice-dollar text-blue-500"></i>報價單預覽
                            </h3>
                            <div class="mt-4 grid grid-cols-2 gap-2">
                                <button id="clear-quote" class="w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors duration-200">
                                    <i class="fas fa-trash-alt mr-2"></i>清空報價
                                </button>
                                <button id="print-quote" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                                    <i class="fas fa-print mr-2"></i>列印報價單
                                </button>
                            </div>
                             <div class="mt-4 space-y-2 text-right">
                                <div class="flex items-center justify-end">
                                    <input type="checkbox" id="include-tax-checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                    <label for="include-tax-checkbox" class="ml-2 text-sm font-medium text-gray-700">顯示含稅價格 (5%)</label>
                                </div>
                                <div class="flex items-center justify-end">
                                    <input type="checkbox" id="show-package-deal-checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                                    <label for="show-package-deal-checkbox" class="ml-2 text-sm font-medium text-gray-700">顯示包套優惠價</label>
                                </div>
                                <div class="flex items-center justify-end">
                                    <input type="checkbox" id="show-total-only-checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                    <label for="show-total-only-checkbox" class="ml-2 text-sm font-medium text-gray-700">列印時僅顯示總價</label>
                                </div>
                            </div>
                        </div>
                        <div id="quote-summary" class="p-6 space-y-3 min-h-[150px]">
                           <p id="empty-quote" class="text-center text-gray-500 pt-12">尚未選擇任何服務項目。</p>
                        </div>
                        <div class="p-6 bg-gray-50 rounded-b-xl">
                            <!-- Save Package Section -->
                            <div id="save-package-section" class="mb-4">
                                <h4 class="font-bold text-md text-gray-700 mb-2">儲存目前選項為組合</h4>
                                <div class="flex gap-2">
                                    <input type="text" id="new-package-name" placeholder="請輸入新組合方案名稱" class="form-input text-sm">
                                    <button id="save-as-package" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors duration-200 flex-shrink-0">
                                        <i class="fas fa-save"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Comparison Section -->
                            <div id="comparison-section" class="mb-4 hidden">
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="font-bold text-md text-gray-700">方案總價</h4>
                                    <button id="clear-comparison" class="text-xs text-red-500 hover:text-red-700">清除比較</button>
                                </div>
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-gray-200">
                                        <tr>
                                            <th class="p-2">方案名稱</th>
                                            <th class="p-2">平均年費</th>
                                            <th class="p-2 text-green-600">可節省預算</th>
                                            <th class="p-2"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="comparison-tbody">
                                        <!-- Comparison rows will be generated by JS -->
                                    </tbody>
                                </table>
                            </div>

                            <div class="space-y-2 mb-4">
                                 <div class="flex justify-between items-center text-gray-600">
                                    <span>平均每月金額</span>
                                    <span id="monthly-average" class="font-semibold text-lg">NT$ 0</span>
                                </div>
                            </div>
                            <div class="border-t border-gray-200 pt-4 space-y-2">
                                 <div class="flex justify-between items-center text-right">
                                    <span class="text-lg font-bold">方案總價 (未稅)</span>
                                    <span id="grand-total" class="font-bold text-2xl text-blue-600">NT$ 0</span>
                                </div>
                                <div id="tax-total-container" class="hidden flex justify-between items-center text-right">
                                    <span class="text-lg font-bold">方案總價 (含稅)</span>
                                    <span id="grand-total-taxed" class="font-bold text-2xl text-red-600">NT$ 0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // =================================================================
            // 1. STATE MANAGEMENT & CONFIGURATION
            // =================================================================

            let priceStore = {};
            let currentPackageId = null;
            let allPackages = {};
            let comparisonList = [];

            const dom = {
                appContainer: document.getElementById('app-container'),
                priceSettingsModal: document.getElementById('price-settings-modal'),
                quoteSummary: document.getElementById('quote-summary'),
                grandTotalEl: document.getElementById('grand-total'),
                monthlyAverageEl: document.getElementById('monthly-average'),
                taxCheckbox: document.getElementById('include-tax-checkbox'),
                showPackageDealCheckbox: document.getElementById('show-package-deal-checkbox'),
                showTotalOnlyCheckbox: document.getElementById('show-total-only-checkbox'),
                taxTotalContainer: document.getElementById('tax-total-container'),
                grandTotalTaxedEl: document.getElementById('grand-total-taxed'),
                comparisonSection: document.getElementById('comparison-section'),
                comparisonTbody: document.getElementById('comparison-tbody'),
                packagesContainer: document.getElementById('packages-container'),
                priceSettingsContainer: document.getElementById('price-settings-container'),
                additionalServicesContainer: document.getElementById('additional-services'),
            };

            const serviceCalculators = {
                'inner-page-design': c => (priceStore['inner-page-design']?.price ?? 20000) * (parseInt(c.querySelector('.inner-page-count').value) || 0),
                'language-add': c => ((priceStore['language-add']?.price ?? 8000) * (parseInt(c.querySelector('.language-count').value) || 0)) + ((priceStore['language-add-special']?.price ?? 10000) * (parseInt(c.querySelector('.special-language-count').value) || 0)),
                'blog-writing': c => ((priceStore['blog-writing']?.price ?? 15000) * (parseInt(c.querySelector('.chinese-blog-count').value) || 0)) + ((priceStore['blog-writing-en']?.price ?? 15000) * (parseInt(c.querySelector('.english-blog-count').value) || 0)),
                'mailcloud': c => (c.querySelector('.mailcloud-setup-check').checked ? (priceStore['mailcloud-setup']?.price ?? 1000) : 0) + ((parseInt(c.querySelector('.mailcloud-quantity').value) || 0) * (parseInt(c.querySelector('.mailcloud-years').value) || 0) * (priceStore['mailcloud-account']?.price ?? 1200)),
                'custom-dev': () => priceStore['custom-dev']?.price || 0
            };
            
            // =================================================================
            // 2. INITIALIZATION
            // =================================================================

            function initialize() {
                loadPriceStore();
                populatePriceSettings();
                loadCustomPackages();
                setupEventListeners();
                loadState();
                generateQuoteInfo();
                updateQuote();
                document.querySelector('.nav-link[data-tab="combo-packages"]')?.click();
            }

            function loadPriceStore() {
                const savedPrices = JSON.parse(localStorage.getItem('customPriceStore') || '{}');
                document.querySelectorAll('div[data-service-id]').forEach(el => {
                    const id = el.dataset.serviceId;
                    if (!id) return;
                    if (!priceStore[id]) priceStore[id] = {};
                    const main = el.querySelector('.service-checkbox');
                    if (main) {
                        const price = parseFloat(main.dataset.price) || 0;
                        priceStore[id].price = price;
                        priceStore[id].basePrice = price; // Default basePrice
                    }
                    const renewal = el.querySelector('.renewal-checkbox');
                    if (renewal) {
                        const renewalPrice = parseFloat(renewal.dataset.renewalPrice) || 0;
                        priceStore[id].renewal = renewalPrice;
                        priceStore[id].baseRenewal = renewalPrice; // Default baseRenewal
                    }
                });
                const defaults = { 'language-add': { price: 8000, basePrice: 8000 }, 'language-add-special': { price: 10000, basePrice: 10000 }, 'blog-writing': { price: 15000, basePrice: 15000 }, 'blog-writing-en': { price: 15000, basePrice: 15000 }, 'mailcloud-setup': { price: 1000, basePrice: 1000 }, 'mailcloud-account': { price: 1200, basePrice: 1200 } };
                Object.assign(priceStore, defaults);

                for (const id in savedPrices) {
                    if (!priceStore[id]) priceStore[id] = {};
                    Object.assign(priceStore[id], savedPrices[id]);
                }
            }
            
            function populatePriceSettings() {
                dom.priceSettingsContainer.innerHTML = ''; 
                document.querySelectorAll('.border[data-service-id]').forEach(el => {
                    const id = el.dataset.serviceId, name = el.querySelector('h3').textContent;
                    if (!id) return;
                    if (priceStore[id]?.price !== undefined) addPriceSettingRow(id, name, 'price', priceStore[id].price, priceStore[id].basePrice);
                    if (priceStore[id]?.renewal !== undefined) addPriceSettingRow(id, `${name} - 續約`, 'renewal', priceStore[id].renewal, priceStore[id].baseRenewal);
                });
                const calcItems = [ {id: 'language-add', name: '新增語系 (一般)'}, {id: 'language-add-special', name: '新增語系 (特殊)'}, {id: 'blog-writing', name: '部落格文案撰寫 (中文)'}, {id: 'blog-writing-en', name: '部落格文案撰寫 (英文)'}, {id: 'mailcloud-setup', name: 'MailCloud 首次設定費'}, {id: 'mailcloud-account', name: 'MailCloud 帳號費用/年'} ];
                calcItems.forEach(item => { if (priceStore[item.id]?.price !== undefined) addPriceSettingRow(item.id, item.name, 'price', priceStore[item.id].price, priceStore[item.id].basePrice); });
            }
            
            function addPriceSettingRow(id, name, type, price, basePrice) {
                const row = document.createElement('div');
                row.className = 'grid grid-cols-[1fr_auto_auto] gap-x-2 items-center py-2 border-b';
                row.innerHTML = `
                    <label for="price-edit-${type}-${id}" class="text-sm">${name}</label>
                    <div class="flex flex-col"><label class="text-xs text-gray-500 text-center">售價</label><input type="number" id="price-edit-${type}-${id}" data-target-id="${id}" data-price-type="${type}" class="form-input w-24 highlight-input" value="${price}"></div>
                    <div class="flex flex-col"><label class="text-xs text-gray-500 text-center">底價</label><input type="number" id="base-price-edit-${type}-${id}" data-target-id="${id}" data-price-type="base${type.charAt(0).toUpperCase() + type.slice(1)}" class="form-input w-24 highlight-input" value="${basePrice ?? price}"></div>
                `;
                dom.priceSettingsContainer.appendChild(row);
            }

            function generateQuoteInfo() {
                const quoteNumInput = document.getElementById('cust-quote-num');
                if (quoteNumInput.value) return;
                const now = new Date(), p = (n) => n.toString().padStart(2, '0');
                quoteNumInput.value = `${now.getFullYear()}${p(now.getMonth() + 1)}${p(now.getDate())}${p(now.getHours())}${p(now.getMinutes())}`;
                document.getElementById('cust-date').value = `${now.getFullYear()}-${p(now.getMonth() + 1)}-${p(now.getDate())}`;
            }

            // =================================================================
            // 3. EVENT HANDLING
            // =================================================================
            
            function setupEventListeners() {
                dom.appContainer.addEventListener('click', handleAppClick);
                dom.appContainer.addEventListener('input', handleAppInput);
                dom.appContainer.addEventListener('change', handleAppChange);
                dom.appContainer.addEventListener('blur', (e) => { if (e.target.matches('[contenteditable="true"]')) saveState(); }, true);
                document.getElementById('open-price-settings').addEventListener('click', () => dom.priceSettingsModal.classList.remove('hidden'));
                document.getElementById('close-price-settings').addEventListener('click', () => dom.priceSettingsModal.classList.add('hidden'));
                document.getElementById('add-custom-item').addEventListener('click', addCustomItem);
                dom.priceSettingsContainer.addEventListener('input', handlePriceSettingChange);
            }

            function handleAppClick(e) {
                const target = e.target, card = target.closest('.package-card');
                if (target.matches('.nav-link')) { e.preventDefault(); handleTabClick(target); }
                else if (target.matches('.stepper-btn')) { handleStepperClick(target); }
                else if (target.matches('.select-package-btn') && card) { selectPackage(card.dataset.packageId); }
                else if (target.closest('.delete-custom-package-btn') && card) { if (confirm(`確定要刪除自訂方案 "${allPackages[card.dataset.packageId].name}" 嗎？`)) deleteCustomPackage(card.dataset.packageId); }
                else if (target.closest('.compare-btn') && card) { toggleCompare(card.dataset.packageId, target.closest('.compare-btn')); }
                else if (target.id === 'clear-quote') { if (confirm('確定要清空所有已選的服務項目嗎？客戶資料將會保留。')) clearQuoteData(); }
                else if (target.id === 'print-quote') { printQuote(); }
                else if (target.id === 'clear-customer-info') { clearCustomerInfo(); }
                else if (target.id === 'save-as-package') { saveCurrentSelectionAsPackage(); }
                else if (target.id === 'clear-comparison') { clearComparison(); }
                else if (target.matches('.remove-from-compare')) {
                    const id = target.dataset.id, btn = document.querySelector(`.package-card[data-package-id="${id}"] .compare-btn`);
                    toggleCompare(id, btn);
                }
            }
            
            function handleAppInput(e) { if (e.target.matches('.description-input, .number-input, #customer-info-form input, header input, #payment-method-notes')) { updateQuote(); saveState(); } }
            function handleAppChange(e) { if (e.target.matches('.service-checkbox, .renewal-checkbox, .mailcloud-setup-check, #include-tax-checkbox, #show-package-deal-checkbox, #show-total-only-checkbox')) { if (e.target.matches('.service-checkbox, .renewal-checkbox')) { currentPackageId = null; document.querySelectorAll('.package-card').forEach(c => c.classList.remove('selected')); } updateQuote(); saveState(); } }
            function handleTabClick(link) { document.querySelectorAll('.nav-link').forEach(i => i.classList.remove('active')); link.classList.add('active'); document.querySelectorAll('.tab-content').forEach(c => c.classList.toggle('hidden', c.id !== link.dataset.tab)); }
            function handleStepperClick(btn) { const input = btn.closest('.number-input-wrapper').querySelector('.number-input'), step = parseFloat(btn.dataset.step) || 1, min = parseFloat(input.min) ?? 0; let val = parseFloat(input.value) || 0; val += (btn.classList.contains('plus') ? step : -step); if (val < min) val = min; input.value = step < 1 ? val.toFixed(2) : val; input.dispatchEvent(new Event('input', { bubbles: true })); }
            function handlePriceSettingChange(e) { if (e.target.matches('.highlight-input')) { const { targetId, priceType } = e.target.dataset, val = parseFloat(e.target.value) || 0; if (!priceStore[targetId]) priceStore[targetId] = {}; priceStore[targetId][priceType] = val; updatePriceDisplays(targetId, priceType, val); savePriceStore(); updateQuote(); } }

            // =================================================================
            // 4. CALCULATION LOGIC & UI
            // =================================================================

            function updateQuote() {
                const { html, totalCost, maxYears, totalOriginalCost } = getQuoteDetails(false);
                const monthly = totalCost > 0 ? Math.round(totalCost / (maxYears * 12)) : 0;
                
                // Update Grand Total (untaxed)
                if (dom.showPackageDealCheckbox.checked && totalCost < totalOriginalCost) {
                    dom.grandTotalEl.innerHTML = `<span class="text-base text-gray-500 line-through mr-2">NT$ ${Math.round(totalOriginalCost).toLocaleString()}</span><span class="font-bold text-2xl text-blue-600">NT$ ${Math.round(totalCost).toLocaleString()}</span>`;
                } else {
                    dom.grandTotalEl.innerHTML = `<span class="font-bold text-2xl text-blue-600">NT$ ${Math.round(totalCost).toLocaleString()}</span>`;
                }

                dom.monthlyAverageEl.textContent = `NT$ ${monthly.toLocaleString()}`;
                
                // Update Grand Total (taxed)
                if (dom.taxCheckbox.checked) {
                    const taxedTotal = totalCost * 1.05;
                    const taxedOriginalTotal = totalOriginalCost * 1.05;
                    if (dom.showPackageDealCheckbox.checked && totalCost < totalOriginalCost) {
                        dom.grandTotalTaxedEl.innerHTML = `<span class="text-base text-gray-500 line-through mr-2">NT$ ${Math.round(taxedOriginalTotal).toLocaleString()}</span><span class="font-bold text-2xl text-red-600">NT$ ${Math.round(taxedTotal).toLocaleString()}</span>`;
                    } else {
                        dom.grandTotalTaxedEl.innerHTML = `<span class="font-bold text-2xl text-red-600">NT$ ${Math.round(taxedTotal).toLocaleString()}</span>`;
                    }
                    dom.taxTotalContainer.classList.remove('hidden');
                } else {
                    dom.taxTotalContainer.classList.add('hidden');
                }
                
                dom.quoteSummary.innerHTML = html || '<p id="empty-quote" class="text-center text-gray-500 pt-12">尚未選擇任何服務項目。</p>';
                updateDynamicServicePrices();
            }
            
            function getQuoteDetails(isForPrint = false, showDealOverride = null) {
                let html = '', totalCost = 0, totalOriginalCost = 0, maxYears = 1;
                document.querySelectorAll('div[data-service-id]').forEach(c => {
                    const id = c.dataset.serviceId, main = c.querySelector('.service-checkbox'), renewal = c.querySelector('.renewal-checkbox');
                    if (!main || (!main.checked && !(renewal && renewal.checked))) return;
                    
                    const calc = serviceCalculators[id];
                    let mainCost = 0, renewalCost = 0, mainOriginal = 0, renewalOriginal = 0, years = 1;

                    if (main.checked) {
                        const basePrice = calc ? calc(c) / (parseFloat(c.querySelector('.first-year-discount')?.value) || 1) : (priceStore[id]?.price || 0);
                        mainOriginal = basePrice;
                        const discount = parseFloat(c.querySelector('.first-year-discount')?.value) || 1;
                        mainCost = mainOriginal * discount;
                    }

                    if (renewal && renewal.checked) {
                        const rYears = parseInt(c.querySelector('.renewal-years')?.value) || 1;
                        const rDiscount = parseFloat(c.querySelector('.renewal-discount')?.value) || 1;
                        renewalOriginal = (priceStore[id]?.renewal || 0) * rYears;
                        renewalCost = renewalOriginal * rDiscount;
                        years = 1 + rYears;
                    }

                    totalCost += mainCost + renewalCost;
                    totalOriginalCost += mainOriginal + renewalOriginal;
                    maxYears = Math.max(maxYears, years);
                    
                    const itemHtml = generateItemHTML(c, mainCost, renewalCost, isForPrint, showDealOverride);
                    if (itemHtml) html += `<div class="py-2 border-b border-gray-100 break-inside-avoid">${itemHtml}</div>`;
                });
                return { html, totalCost, maxYears, totalOriginalCost };
            }

            function calculatePackagePrice(id) { const pkg = allPackages[id]; if (!pkg) return { totalPrice: 0, totalYears: 1 }; let total = 0, maxYears = 1; pkg.items.forEach(item => { let itemTotal = 0, itemYears = 1; const serviceId = item.id; if (item.mainChecked) itemTotal += (priceStore[serviceId]?.price || 0) * (parseFloat(item.inputs['first-year-discount']) || 1); if (item.renewalChecked) { const years = parseInt(item.inputs['renewal-years']) || 1; itemTotal += (priceStore[serviceId]?.renewal || 0) * years * (parseFloat(item.inputs['renewal-discount']) || 1); itemYears = 1 + years; } total += itemTotal; maxYears = Math.max(maxYears, itemYears); }); return { totalPrice: total, totalYears: maxYears }; }
            function updateDynamicServicePrices() { document.querySelectorAll('[data-service-id]').forEach(c => { const id = c.dataset.serviceId, calc = serviceCalculators[id]; if (calc) { const price = calc(c), el = c.querySelector('.language-total, .blog-total, .mailcloud-total, .inner-page-total'), p = c.querySelector('.language-cost-p, .blog-cost-p, .mailcloud-cost-p'); if (el) el.textContent = `NT$ ${price.toLocaleString()}`; if (p) p.classList.toggle('hidden', price === 0); } }); }
            
            function generateItemHTML(c, mainCost, renewalCost, isForPrint, showDealOverride = null) {
                const main = c.querySelector('.service-checkbox'), renewal = c.querySelector('.renewal-checkbox');
                if (!main.checked && !renewal?.checked) return '';
                
                const id = c.dataset.serviceId, name = main.dataset.name, note = c.querySelector('.description-input')?.value.trim() || '';
                const hidePricesInPrint = isForPrint && dom.showTotalOnlyCheckbox.checked;
                let mainHTML = '', renewalHTML = '';

                const calc = serviceCalculators[id];
                const basePrice = calc ? calc(c) : (priceStore[id]?.basePrice ?? priceStore[id]?.price ?? 0);
                const baseRenewal = priceStore[id]?.baseRenewal ?? priceStore[id]?.renewal ?? 0;
                
                const generatePriceHTML = (discountedPrice, originalPrice, priceTextPrefix = 'NT$ ') => {
                    const showDeal = (showDealOverride !== null) ? showDealOverride : dom.showPackageDealCheckbox.checked;
                    let text = `${priceTextPrefix}${Math.round(discountedPrice).toLocaleString()}`;
                    if (id === 'custom-dev' && discountedPrice === 0) text = '依工程師估價';
                    else if (discountedPrice === 0 && originalPrice > 0) text = `<span class="text-green-600 font-semibold">特別優惠</span>`;

                    if (showDeal && discountedPrice < originalPrice && originalPrice > 0) {
                        return `<span class="text-xs text-gray-500 line-through mr-2">NT$ ${Math.round(originalPrice).toLocaleString()}</span><span class="text-red-600">${text}</span>`;
                    }
                    return `<span>${text}</span>`;
                };

                if (main.checked) {
                    const discount = parseFloat(c.querySelector('.first-year-discount')?.value) || 1;
                    const priceDisplayHTML = hidePricesInPrint ? '' : generatePriceHTML(mainCost, basePrice);
                    const discountText = (discount !== 1 && basePrice > 0) ? `<div class="text-xs text-green-600">首年 ${Math.round(discount*100)} 折</div>` : '';
                    const priceColHTML = hidePricesInPrint ? '' : `
                        <div class="text-right flex-shrink-0 price-col">
                            <div class="text-sm font-semibold">${priceDisplayHTML}</div>
                            ${discountText}
                        </div>`;

                    if (isForPrint) {
                        const descHTML = c.querySelector('p.text-gray-500')?.innerHTML || '';
                        const featuresHTML = c.querySelector('ul.list-disc')?.innerHTML || '';
                        mainHTML = `<div class="flex justify-between items-start">
                                        <div class="flex-1 pr-2"><span class="text-sm text-gray-800 font-bold">${getDisplayName(c)}</span></div>
                                        ${priceColHTML}
                                    </div>
                                    ${descHTML ? `<p class="text-xs text-gray-500 mt-1">${descHTML}</p>` : ''}
                                    ${featuresHTML ? `<div class="text-xs text-gray-600 mt-2 pl-2 features-list"><ul>${featuresHTML}</ul></div>` : ''}
                                    ${note ? `<p class="text-xs text-gray-500 mt-2 pl-2 border-l-2 border-gray-200">${note}</p>` : ''}`;
                    } else {
                        mainHTML = `<div class="flex justify-between items-start">
                                        <div class="flex-1 pr-2"><span class="text-sm text-gray-800 font-bold">${getDisplayName(c)}</span></div>
                                        ${priceColHTML}
                                    </div>
                                    ${note ? `<p class="text-xs text-gray-500 mt-2 pl-2 border-l-2 border-gray-200">${note}</p>` : ''}`;
                    }
                }

                if (renewal && renewal.checked) {
                    const years = parseInt(c.querySelector('.renewal-years').value) || 1;
                    const discount = parseFloat(c.querySelector('.renewal-discount').value) || 1;
                    const originalRenewalTotal = baseRenewal * years;
                    const priceDisplayHTML = hidePricesInPrint ? '' : generatePriceHTML(renewalCost, originalRenewalTotal);
                    const discountText = (discount !== 1) ? `<div class="text-xs text-green-600">${Math.round(discount*100)} 折</div>` : '';
                    const priceColHTML = hidePricesInPrint ? '' : `
                        <div class="text-right price-col">
                            <div class="text-sm font-semibold">${priceDisplayHTML}</div>
                            ${discountText}
                        </div>`;
                    
                    let content = `<div class="flex justify-between items-center ${main.checked ? 'pl-4 mt-1' : ''}">
                                    <span class="text-sm text-gray-700">${renewal.dataset.name} (${years}年)</span>
                                    ${priceColHTML}
                                   </div>`;

                    if (isForPrint && !main.checked) {
                        const descHTML = c.querySelector('p.text-gray-500')?.innerHTML || '';
                        const featuresHTML = c.querySelector('ul.list-disc')?.innerHTML || '';
                        content = `<div class="flex justify-between items-start">
                                       <div class="flex-1 pr-2"><span class="text-sm text-gray-800 font-bold">${name}</span></div>
                                   </div>
                                   ${descHTML ? `<p class="text-xs text-gray-500 mt-1">${descHTML}</p>` : ''}
                                   ${featuresHTML ? `<div class="text-xs text-gray-600 mt-2 pl-2 features-list"><ul>${featuresHTML}</ul></div>` : ''}
                                   <div class="mt-2 pt-2 border-t border-gray-200"></div>
                                   ${content}`;
                    }
                    renewalHTML = content;
                }

                return mainHTML + renewalHTML;
            }


            function getDisplayName(c) { const id = c.dataset.serviceId; let name = c.querySelector('.service-checkbox').dataset.name; const details = []; switch (id) { case 'inner-page-design': details.push(`共 ${c.querySelector('.inner-page-count').value || 0} 頁`); break; case 'language-add': const totalLang = (parseInt(c.querySelector('.language-count').value) || 0) + (parseInt(c.querySelector('.special-language-count').value) || 0); if (totalLang > 0) details.push(`共 ${totalLang} 組`); break; case 'blog-writing': const totalBlog = (parseInt(c.querySelector('.chinese-blog-count').value) || 0) + (parseInt(c.querySelector('.english-blog-count').value) || 0); if (totalBlog > 0) details.push(`共 ${totalBlog} 篇`); break; case 'mailcloud': const q = parseInt(c.querySelector('.mailcloud-quantity').value) || 0, y = parseInt(c.querySelector('.mailcloud-years').value) || 0; if (q > 0) details.push(`${q} 組`); if (y > 0) details.push(`${y} 年`); break; } return details.length > 0 ? `${name} (${details.join(', ')})` : name; }
            function updatePriceDisplays(id, type, val) { const fVal = `NT$ ${val.toLocaleString()}`; if (type === 'price') { const el = document.querySelector(`.price-display[data-price-id="${id}"]`); if (el) el.textContent = (id === 'custom-dev' && val === 0) ? '依工程師估價' : fVal; } else if (type === 'renewal') { const el = document.querySelector(`.renewal-price-display[data-renewal-price-id="${id}"]`); if (el) el.textContent = `${fVal} /年`; } }
            function updateComparisonTable() { if (comparisonList.length === 0) { dom.comparisonSection.classList.add('hidden'); return; } dom.comparisonSection.classList.remove('hidden'); dom.comparisonTbody.innerHTML = ''; const details = comparisonList.map(id => { const d = calculatePackagePrice(id); const avg = d.totalPrice > 0 && d.totalYears > 0 ? d.totalPrice / d.totalYears : 0; return { id, name: allPackages[id].name, averageCost: avg }; }); if (details.length === 0) return; const maxAvg = Math.max(...details.map(p => p.averageCost)); details.forEach(d => { const savings = maxAvg - d.averageCost; const row = document.createElement('tr'); row.className = 'border-b'; row.innerHTML = `<td class="p-2 font-semibold">${d.name}</td><td class="p-2">NT$ ${Math.round(d.averageCost).toLocaleString()} /年</td><td class="p-2 text-green-600">${savings > 0 ? `省 ${Math.round(savings).toLocaleString()}` : '-'}</td><td class="p-2"><button class="text-red-500 hover:text-red-700 remove-from-compare" data-id="${d.id}">&times;</button></td>`; dom.comparisonTbody.appendChild(row); }); }

            // =================================================================
            // 6. CORE FUNCTIONALITY & ACTIONS
            // =================================================================

            function clearQuoteData() {
                clearQuoteSelections();
                const savedState = localStorage.getItem('quoteAppState');
                if (savedState) {
                    const state = JSON.parse(savedState);
                    state.services = {}; // Clear only services
                    localStorage.setItem('quoteAppState', JSON.stringify(state));
                }
            }

            function clearQuoteSelections() {
                document.querySelectorAll('input[type="checkbox"]').forEach(c => {
                    if (!c.id.includes('show-package-deal') && !c.id.includes('show-total-only') && !c.id.includes('include-tax')) {
                        c.checked = false;
                    }
                });
                document.querySelectorAll('.renewal-years, .inner-page-count').forEach(i => i.value = '1');
                document.querySelectorAll('.renewal-discount, .first-year-discount').forEach(i => i.value = '1');
                document.querySelectorAll('.language-count, .special-language-count, .chinese-blog-count, .english-blog-count, .mailcloud-quantity, .mailcloud-years').forEach(i => i.value = '0');
                document.querySelectorAll('.package-card').forEach(c => c.classList.remove('selected'));
                currentPackageId = null;
                updateQuote();
            }

            function clearCustomerInfo() {
                document.getElementById('customer-info-form').querySelectorAll('input:not([readonly])').forEach(i => i.value = '');
                document.getElementById('payment-method-notes').value = '';
                generateQuoteInfo();
                saveState();
            }

            function selectPackage(id) { clearQuoteSelections(); const pkg = allPackages[id]; if (!pkg) return; currentPackageId = id; document.querySelector(`.package-card[data-package-id="${id}"]`)?.classList.add('selected'); pkg.items.forEach(item => { const c = document.querySelector(`div[data-service-id="${item.id}"]`); if (!c) return; const main = c.querySelector('.service-checkbox'); if (main) main.checked = item.mainChecked; const renewal = c.querySelector('.renewal-checkbox'); if (renewal) renewal.checked = item.renewalChecked; for (const key in item.inputs) { const el = c.querySelector(`.${key}, #${key}`); if (el) el.type === 'checkbox' ? (el.checked = item.inputs[key]) : (el.value = item.inputs[key]); } }); updateQuote(); saveState(); }
            function toggleCompare(id, btn) { const i = comparisonList.indexOf(id); if (i > -1) { comparisonList.splice(i, 1); btn.classList.remove('added'); btn.innerHTML = `<i class="fas fa-balance-scale-right mr-2"></i>加入比較`; } else { comparisonList.push(id); btn.classList.add('added'); btn.innerHTML = `<i class="fas fa-check mr-2"></i>已加入比較`; } updateComparisonTable(); }
            function clearComparison() { comparisonList = []; document.querySelectorAll('.compare-btn').forEach(b => { b.classList.remove('added'); b.innerHTML = `<i class="fas fa-balance-scale-right mr-2"></i>加入比較`; }); updateComparisonTable(); }

            // =================================================================
            // 7. LOCALSTORAGE & CUSTOM ITEMS
            // =================================================================
            
            function savePriceStore() { localStorage.setItem('customPriceStore', JSON.stringify(priceStore)); }
            function saveState() { const state = { services: {}, customerInfo: {}, projectManagerInfo: {}, taxChecked: dom.taxCheckbox.checked, showPackageDeal: dom.showPackageDealCheckbox.checked, showTotalOnly: dom.showTotalOnlyCheckbox.checked, paymentNotes: document.getElementById('payment-method-notes').value }; document.querySelectorAll('div[data-service-id]').forEach(c => { const id = c.dataset.serviceId; if (!id) return; const sState = { inputs: {}, checkboxes: {}, descriptions: {} }; c.querySelectorAll('input, textarea').forEach(i => { const key = i.id || i.classList[0]; if (i.type === 'checkbox') sState.checkboxes[key] = i.checked; else sState.inputs[key] = i.value; }); const p = c.querySelector('p[contenteditable="true"]'); if (p) sState.descriptions.p = p.innerHTML; const ul = c.querySelector('ul[contenteditable="true"]'); if (ul) sState.descriptions.ul = ul.innerHTML; state.services[id] = sState; }); document.querySelectorAll('#customer-info-form input').forEach(i => { if (i.id) state.customerInfo[i.id] = i.value; }); document.querySelectorAll('header input').forEach(i => { if (i.id) state.projectManagerInfo[i.id] = i.value; }); localStorage.setItem('quoteAppState', JSON.stringify(state)); }
            function loadState() { const saved = localStorage.getItem('quoteAppState'); if (!saved) return; const state = JSON.parse(saved); if (state.services) { for (const id in state.services) { const c = document.querySelector(`div[data-service-id="${id}"]`); if (!c) continue; const s = state.services[id]; for (const key in s.inputs) { const i = c.querySelector(`#${key}, .${key}`); if (i) i.value = s.inputs[key]; } for (const key in s.checkboxes) { const cb = c.querySelector(`#${key}, .${key}`); if (cb) cb.checked = s.checkboxes[key]; } if (s.descriptions.p) { const p = c.querySelector('p[contenteditable="true"]'); if (p) p.innerHTML = s.descriptions.p; } if (s.descriptions.ul) { const ul = c.querySelector('ul[contenteditable="true"]'); if (ul) ul.innerHTML = s.descriptions.ul; } } } if (state.customerInfo) { for (const id in state.customerInfo) { const i = document.getElementById(id); if (i) i.value = state.customerInfo[id]; } } if (state.projectManagerInfo) { for (const id in state.projectManagerInfo) { const i = document.getElementById(id); if (i) i.value = state.projectManagerInfo[id]; } } document.getElementById('payment-method-notes').value = state.paymentNotes || ''; dom.taxCheckbox.checked = state.taxChecked || false; dom.showPackageDealCheckbox.checked = state.showPackageDeal === undefined ? true : state.showPackageDeal; dom.showTotalOnlyCheckbox.checked = state.showTotalOnly || false; }
            function saveCurrentSelectionAsPackage() { const nameInput = document.getElementById('new-package-name'), name = nameInput.value.trim(); if (!name) { alert('請為您的組合方案命名。'); nameInput.focus(); return; } const items = []; document.querySelectorAll('div[data-service-id]').forEach(c => { const main = c.querySelector('.service-checkbox'), renewal = c.querySelector('.renewal-checkbox'); if ((main && main.checked) || (renewal && renewal.checked)) { const item = { id: c.dataset.serviceId, mainChecked: main ? main.checked : false, renewalChecked: renewal ? renewal.checked : false, inputs: {} }; c.querySelectorAll('.first-year-discount, .renewal-years, .renewal-discount, .inner-page-count, .language-count, .special-language-count, .chinese-blog-count, .english-blog-count, .mailcloud-quantity, .mailcloud-years, .description-input, .mailcloud-setup-check').forEach(i => { const key = i.classList[0] || i.id; item.inputs[key] = i.type === 'checkbox' ? i.checked : i.value; }); items.push(item); } }); if (items.length === 0) { alert("沒有選擇任何項目，無法儲存。"); return; } const id = 'custom-' + Date.now(); allPackages[id] = { id, name, items, isCustom: true }; localStorage.setItem('customQuotePackages', JSON.stringify(allPackages)); renderCustomPackage(allPackages[id]); nameInput.value = ''; alert(`組合方案 "${name}" 已儲存！`); }
            function loadCustomPackages() { const saved = JSON.parse(localStorage.getItem('customQuotePackages') || '{}'); Object.values(saved).forEach(pkg => { if (pkg.isCustom) { allPackages[pkg.id] = pkg; renderCustomPackage(pkg); } }); }
            function renderCustomPackage(pkg) { const card = document.createElement('div'); card.className = 'package-card border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-all duration-300 relative flex flex-col'; card.dataset.packageId = pkg.id; const itemsHTML = pkg.items.map(item => { const c = document.querySelector(`[data-service-id="${item.id}"]`); if (!c) return ''; let html = ''; if (item.mainChecked) html += `<li>${c.querySelector('.service-checkbox').dataset.name}</li>`; if (item.renewalChecked) html += `<li>${c.querySelector('.renewal-checkbox').dataset.name} (${item.inputs['renewal-years'] || 1}年)</li>`; return html; }).join(''); card.innerHTML = `<button class="delete-custom-package-btn absolute top-3 left-3 text-gray-400 hover:text-red-500 transition-colors z-10"><i class="fas fa-trash-alt"></i></button><div class="absolute top-4 right-4 bg-gray-500 text-white text-xs font-bold px-2 py-1 rounded-full">自訂方案</div><h3 class="text-xl font-bold text-gray-700">${pkg.name}</h3><ul class="list-disc list-inside mt-4 text-gray-600 space-y-2 text-sm flex-grow">${itemsHTML}</ul><div class="mt-auto pt-4 text-right"><button class="mt-2 w-full bg-yellow-400 text-yellow-800 px-4 py-1.5 rounded-lg hover:bg-yellow-500 transition-colors text-sm font-bold compare-btn"><i class="fas fa-balance-scale-right mr-2"></i>加入比較</button><button class="mt-3 bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 w-full select-package-btn">選擇此方案</button></div>`; dom.packagesContainer.appendChild(card); }
            function deleteCustomPackage(id) { document.querySelector(`[data-package-id="${id}"]`)?.remove(); delete allPackages[id]; localStorage.setItem('customQuotePackages', JSON.stringify(allPackages)); updateQuote(); }
            function addCustomItem() { const nameInput = document.getElementById('custom-item-name'), priceInput = document.getElementById('custom-item-price'), name = nameInput.value.trim(), price = parseFloat(priceInput.value); if (!name || isNaN(price)) { alert('請輸入有效的項目名稱和價格。'); return; } const id = 'custom-' + Date.now(); const html = `<div class="border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow duration-300" data-service-id="${id}"><div class="flex items-start justify-between"><div class="flex-1"><h3 class="text-xl font-bold text-gray-700">${name}</h3><p contenteditable="true" class="text-gray-500 mt-1">請在此輸入服務描述...</p></div><input type="checkbox" class="service-checkbox h-6 w-6 rounded border-gray-400 text-gray-600 focus:ring-gray-500 cursor-pointer ml-4" data-name="${name}" data-price="${price}"></div><ul contenteditable="true" class="list-disc list-inside mt-4 text-gray-600 space-y-2"><li>請在此編輯功能項目...</li></ul><div class="mt-2"><textarea maxlength="30" class="form-input text-sm description-input" placeholder="備註說明 (最多30字)"></textarea></div><div class="mt-4 flex justify-end items-baseline gap-6"><p class="text-gray-500">一次性費用</p><p class="text-gray-800">費用: <span class="font-bold text-2xl text-gray-600 price-display" data-price-id="${id}">NT$ ${price.toLocaleString()}</span></p></div></div>`; dom.additionalServicesContainer.insertAdjacentHTML('beforeend', html); priceStore[id] = { price: price, basePrice: price }; savePriceStore(); addPriceSettingRow(id, name, 'price', price, price); nameInput.value = ''; priceInput.value = ''; handleTabClick(document.querySelector('[data-tab="additional-services"]')); }

            // =================================================================
            // 8. PRINT FUNCTIONALITY
            // =================================================================

            function printQuote() { 
                if (document.querySelectorAll('.service-checkbox:checked, .renewal-checkbox:checked').length === 0) { 
                    alert('請至少選擇一個報價項目後再列印。'); 
                    return; 
                }
                const { totalCost, totalOriginalCost } = getQuoteDetails(true, dom.showPackageDealCheckbox.checked);

                const data = { 
                    pmName: document.getElementById('project-manager-name').value, 
                    pmPhone: document.getElementById('project-manager-phone').value, 
                    pmEmail: document.getElementById('project-manager-email').value, 
                    custQuoteNum: document.getElementById('cust-quote-num').value || 'N/A', 
                    custDate: document.getElementById('cust-date').value ? new Date(document.getElementById('cust-date').value).toLocaleDateString('zh-TW') : 'N/A', 
                    custName: document.getElementById('cust-name').value || 'N/A', 
                    custContact: document.getElementById('cust-contact').value || 'N/A', 
                    custTel: document.getElementById('cust-tel').value || 'N/A', 
                    custEmail: document.getElementById('cust-email').value || 'N/A', 
                    custTaxId: document.getElementById('cust-tax-id').value || 'N/A', 
                    custAddress: document.getElementById('cust-address').value || 'N/A', 
                    monthlyAverageText: dom.monthlyAverageEl.textContent,
                    includeTax: dom.taxCheckbox.checked, 
                    showTotalOnly: dom.showTotalOnlyCheckbox.checked,
                    showPackageDeal: dom.showPackageDealCheckbox.checked,
                    paymentNotes: document.getElementById('payment-method-notes').value, 
                    itemsHTML: getQuoteDetails(true, dom.showPackageDealCheckbox.checked).html,
                    comparisonTableHTML: dom.comparisonSection.classList.contains('hidden') ? '' : dom.comparisonSection.outerHTML,
                    totalCost: totalCost,
                    totalOriginalCost: totalOriginalCost
                }; 
                const printWindow = window.open('', '_blank'); 
                printWindow.document.write(generatePrintHTML(data)); 
                printWindow.document.close(); 
                setTimeout(() => { 
                    printWindow.print(); 
                    printWindow.close(); 
                }, 250); 
            }
            
            function generatePrintHTML(data) {
                let totalHTML = '';
                let taxedTotalHTML = '';

                if (data.showPackageDeal && data.totalCost < data.totalOriginalCost) {
                    totalHTML = `<span class="text-base text-gray-500 line-through mr-2">NT$ ${Math.round(data.totalOriginalCost).toLocaleString()}</span><span class="font-bold text-2xl text-blue-600">NT$ ${Math.round(data.totalCost).toLocaleString()}</span>`;
                } else {
                    totalHTML = `<span class="font-bold text-2xl text-blue-600">NT$ ${Math.round(data.totalCost).toLocaleString()}</span>`;
                }

                if (data.includeTax) {
                    const taxedTotal = data.totalCost * 1.05;
                    const taxedOriginalTotal = data.totalOriginalCost * 1.05;
                     if (data.showPackageDeal && data.totalCost < data.totalOriginalCost) {
                        taxedTotalHTML = `<div class="flex justify-between items-center mt-2 text-right"><span class="text-lg font-bold">方案總價 (含稅)</span><span><span class="text-base text-gray-500 line-through mr-2">NT$ ${Math.round(taxedOriginalTotal).toLocaleString()}</span><span class="font-bold text-2xl text-red-600">NT$ ${Math.round(taxedTotal).toLocaleString()}</span></span></div>`;
                    } else {
                        taxedTotalHTML = `<div class="flex justify-between items-center mt-2 text-right"><span class="text-lg font-bold">方案總價 (含稅)</span><span class="font-bold text-2xl text-red-600">NT$ ${Math.round(taxedTotal).toLocaleString()}</span></div>`;
                    }
                }
            
                const printHeaderHTML = `
                <header class="mb-8 flex justify-between items-start">
                    <div>
                        <div class="flex items-center gap-4 mb-2">
                             <img src="https://www.winho.com.tw/uploadfiles/338/images-new/winho-logo5.png" alt="崴浤科技 LOGO" class="h-12">
                             <h1 class="text-2xl font-bold text-gray-800">崴浤科技股份有限公司</h1>
                        </div>
                        <p class="text-gray-500 text-sm">網站設計 & SEO 優化方案報價單</p>
                    </div>
                    <div class="text-sm text-gray-700 text-right">
                        <div class="grid grid-cols-[auto_1fr] gap-x-2 text-left">
                            <strong class="font-semibold">專案人員:</strong> <span>${data.pmName}</span>
                            <strong class="font-semibold">電話:</strong> <span>${data.pmPhone}</span>
                            <strong class="font-semibold">Email:</strong> <span>${data.pmEmail}</span>
                        </div>
                    </div>
                </header>`;

                const bodyClass = data.showTotalOnly ? 'print-hide-price' : '';

                return `<html><head><title>崴浤科技股份有限公司 - 報價單</title><script src="https://cdn.tailwindcss.com"><\/script><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet"><style>body { font-family: 'Noto Sans TC', sans-serif; -webkit-print-color-adjust: exact; print-color-adjust: exact; } @page { size: A4; margin: 1.5cm; } .break-inside-avoid { break-inside: avoid; } .features-list ul { list-style-type: disc; list-style-position: inside; padding-left: 0.5rem; } .features-list li { margin-top: 0.25rem; } #comparison-section { display: block !important; } .delete-custom-package-btn, .remove-from-compare, .select-package-btn, .compare-btn { display: none !important; } .price-col { display: block; } .print-hide-price .price-col { display: none !important; }</style></head><body class="p-4 ${bodyClass}">${printHeaderHTML}<div class="mb-8 p-4 border rounded-lg bg-gray-50"><h2 class="text-lg font-bold mb-3">報價資訊</h2><div class="grid grid-cols-[auto_1fr_auto_1fr] gap-x-4 gap-y-2 text-sm items-baseline"><strong>報價單號：</strong> <p>${data.custQuoteNum}</p><strong>公司名稱：</strong> <p>${data.custName}</p><strong>報價日期：</strong> <p>${data.custDate}</p><strong>聯絡人：</strong> <p>${data.custContact}</p><strong>電話：</strong> <p>${data.custTel}</p><strong>Email：</strong> <p>${data.custEmail}</p><strong>統一編號：</strong> <p>${data.custTaxId}</p><strong>地址：</strong> <p>${data.custAddress}</p></div></div><div class="mb-8"><h2 class="text-lg font-bold mb-3">報價項目</h2><div class="border rounded-lg p-4">${data.itemsHTML}</div></div><div class="mb-8 break-inside-avoid"><h2 class="text-lg font-bold mb-3">付款方式及備註</h2><div class="border rounded-lg p-4 text-sm whitespace-pre-wrap">${data.paymentNotes || '無'}</div></div><footer class="flex justify-end break-inside-avoid"><div class="w-full md:w-2/3 lg:w-1/2 p-6 bg-gray-50 rounded-lg">${data.comparisonTableHTML}<div class="space-y-2 mb-4 border-t border-gray-200 pt-4 mt-4"><div class="flex justify-between items-center text-gray-600"><span>平均每月金額</span><span class="font-semibold text-lg">${data.monthlyAverageText}</span></div></div><div class="border-t border-gray-200 pt-4 space-y-2"><div class="flex justify-between items-center text-right"><span class="text-xl font-bold">方案總價 (未稅)</span><span>${totalHTML}</span></div>${taxedTotalHTML}</div></div></footer></body></html>`;
            }

            // --- Run Application ---
            initialize();
        });
    </script>
</body>
</html>
